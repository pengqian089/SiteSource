ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],(function(e,t,r){"use strict";var a=e("../token_iterator").TokenIterator;function o(e,t){return e.type.lastIndexOf(t+".xml")>-1}t.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],t.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],t.formatOptions={lineBreaksAfterCommasInCurlyBlock:!0},t.beautify=function(e){var r,s,n,i=new a(e,0,0),c=i.getCurrentToken(),l=e.getTabString(),u=t.singletonTags,m=t.blockTags,p=t.formatOptions||{},f=!1,h=!1,y=!1,b="",d="",g="",k=0,$=0,w=0,x=0,v=0,T=0,C=0,R=0,B=0,O=!1,I=!1,q=!1,_=!1,j={0:0},A=[],F=!1,S=function(){r&&r.value&&"string.regexp"!==r.type&&(r.value=r.value.replace(/^\s*/,""))},K=function(){var e=b.length-1;while(1){if(0==e)break;if(" "!==b[e])break;e-=1}b=b.slice(0,e+1)},L=function(){b=b.trimRight(),f=!1};while(null!==c){if(R=i.getCurrentTokenRow(),i.$rowTokens,r=i.stepForward(),"undefined"!==typeof c){if(d=c.value,v=0,q="style"===g||"ace/mode/css"===e.$modeId,o(c,"tag-open")?(I=!0,r&&(_=-1!==m.indexOf(r.value)),"</"===d&&(_&&!f&&B<1&&B++,q&&(B=1),v=1,_=!1)):o(c,"tag-close")?I=!1:o(c,"comment.start")?_=!0:o(c,"comment.end")&&(_=!1),I||B||"paren.rparen"!==c.type||"}"!==c.value.substr(0,1)||B++,R!==s&&(B=R,s&&(B-=s)),B){for(L();B>0;B--)b+="\n";f=!0,o(c,"comment")||c.type.match(/^(comment|string)$/)||(d=d.trimLeft())}if(d){if("keyword"===c.type&&d.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(A[k]=d,S(),y=!0,d.match(/^(else|elseif)$/)&&b.match(/\}[\s]*$/)&&(L(),h=!0)):"paren.lparen"===c.type?(S(),"{"===d.substr(-1)&&(y=!0,O=!1,I||(B=1)),"{"===d.substr(0,1)&&(h=!0,"["!==b.substr(-1)&&"["===b.trimRight().substr(-1)?(L(),h=!1):")"===b.trimRight().substr(-1)?L():K())):"paren.rparen"===c.type?(v=1,"}"===d.substr(0,1)&&("case"===A[k-1]&&v++,"{"===b.trimRight().substr(-1)?L():(h=!0,q&&(B+=2))),"]"===d.substr(0,1)&&"}"!==b.substr(-1)&&"}"===b.trimRight().substr(-1)&&(h=!1,x++,L()),")"===d.substr(0,1)&&"("!==b.substr(-1)&&"("===b.trimRight().substr(-1)&&(h=!1,x++,L()),K()):"keyword.operator"!==c.type&&"keyword"!==c.type||!d.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===c.type&&";"===d?(L(),S(),y=!0,q&&B++):"punctuation.operator"===c.type&&d.match(/^(:|,)$/)?(L(),S(),d.match(/^(,)$/)&&C>0&&0===T&&p.lineBreaksAfterCommasInCurlyBlock?B++:(y=!0,f=!1)):"support.php_tag"!==c.type||"?>"!==d||f?o(c,"attribute-name")&&b.substr(-1).match(/^\s$/)?h=!0:o(c,"attribute-equals")?(K(),S()):o(c,"tag-close")?(K(),"/>"===d&&(h=!0)):"keyword"===c.type&&d.match(/^(case|default)$/)&&F&&(v=1):(L(),h=!0):(L(),S(),h=!0,y=!0),f&&(!c.type.match(/^(comment)$/)||d.substr(0,1).match(/^[/#]$/))&&(!c.type.match(/^(string)$/)||d.substr(0,1).match(/^['"@]$/))){if(x=w,k>$)for(x++,n=k;n>$;n--)j[n]=x;else k<$&&(x=j[k]);for($=k,w=x,v&&(x-=v),O&&!T&&(x++,O=!1),n=0;n<x;n++)b+=l}if("keyword"===c.type&&d.match(/^(case|default)$/)?!1===F&&(A[k]=d,k++,F=!0):"keyword"===c.type&&d.match(/^(break)$/)&&A[k-1]&&A[k-1].match(/^(case|default)$/)&&(k--,F=!1),"paren.lparen"===c.type&&(T+=(d.match(/\(/g)||[]).length,C+=(d.match(/\{/g)||[]).length,k+=d.length),"keyword"===c.type&&d.match(/^(if|else|elseif|for|while)$/)?(O=!0,T=0):!T&&d.trim()&&"comment"!==c.type&&(O=!1),"paren.rparen"===c.type)for(T-=(d.match(/\)/g)||[]).length,C-=(d.match(/\}/g)||[]).length,n=0;n<d.length;n++)k--,"}"===d.substr(n,1)&&"case"===A[k]&&k--;"text"==c.type&&(d=d.replace(/\s+$/," ")),h&&!f&&(K(),"\n"!==b.substr(-1)&&(b+=" ")),b+=d,y&&(b+=" "),f=!1,h=!1,y=!1,(o(c,"tag-close")&&(_||-1!==m.indexOf(g))||o(c,"doctype")&&">"===d)&&(B=_&&r&&"</"===r.value?-1:1),r&&-1===u.indexOf(r.value)&&(o(c,"tag-open")&&"</"===d?k--:o(c,"tag-open")&&"<"===d?k++:o(c,"tag-close")&&"/>"===d&&k--),o(c,"tag-name")&&(g=d),s=R}}c=r}b=b.trim(),e.doc.setValue(b)},t.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){t.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]})),function(){ace.require(["ace/ext/beautify"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}))}();