layui.config({layimPath:"/lib/layim/",layimAssetsPath:"/lib/layim/layim-assets/"}).extend({layim:layui.cache.layimPath+"layim"}).use(["layim","layer"],function(){var n=layui.layim,t=layui.layer,r=(new signalR.HubConnectionBuilder).withUrl("/robotChat").withAutomaticReconnect().build(),i=(new signalR.HubConnectionBuilder).withUrl("/chathub").withAutomaticReconnect().build();i.start().catch(function(n){return console.error(n.toString())});r.start().then(function(){console.log("robot connection")}).catch(function(n){return console.error(n.toString())});n.config({title:"聊天室",copyright:!0,isAudio:!0,chatLog:"/chat/record",init:{url:"/chat/init",data:{}},min:!0,members:{url:"/chat/groupMembers",type:"get",data:{}},tool:[{alias:"code",title:"代码",icon:"&#xe64e;"}]});n.on("tool(code)",function(n){t.prompt({title:"插入代码",formType:2,shade:0},function(i,r){t.close(r);n("[pre class=layui-code]"+i+"[/pre]")})});n.on("sign",function(n){console.log(n);$.ajax({url:"/Account/UpdateSign",type:"post",data:{sign:n}}).done(function(n){n.success||t.msg(n.msg)}).fail(function(n){console.info(n)})});r.on("Question",function(){});r.on("Answer",function(t){n.getMessage(t)});r.on("SystemError",function(n){t.alert(n)});i.on("ReceiveMessage",function(t){n.getMessage(t)});i.on("System",function(r){r.code<0?(console.log("%cchatHub:"+r.content,"color:#ff00ff"),i.stop()):r.code!==0||r.isGuest?r.code===1&&(t.msg(`${r.user.name}上线了`),n.setFriendStatus(r.user.id,"online")):(t.msg(`${r.user.name}下线了`),n.setFriendStatus(r.user.id,"offline"))});n.on("sendMessage",function(n){n.to.id==="kefu"?r.invoke("SendMessage",n.mine.content).catch(function(n){return console.error(n.toString())}):n.to.type==="friend"?i.invoke("SendMessageToUser",n.to.id,n.mine.content).catch(function(n){return console.error(n.toString())}):n.to.type==="group"&&i.invoke("SendMessageToGroup",n.to.id,n.mine.content).catch(function(n){return console.error(n.toString())})})});
//# sourceMappingURL=chat.min.js.map