const layimOption={CDNBaseAddress:document.head.querySelector("meta[name=cdn-base-address]").content};layui.config({layimPath:layimOption.CDNBaseAddress+"/lib/layim/",layimAssetsPath:layimOption.CDNBaseAddress+"/lib/layim/layim-assets/"}).extend({layim:layui.cache.layimPath+"layim"}).use(["layim","layer"],function(){var t=layui.layim,n=layui.layer,o=(new signalR.HubConnectionBuilder).withUrl("/chathub").withAutomaticReconnect().build();o.start().catch(function(e){return console.error(e.toString())}),t.config({title:"聊天室",copyright:!0,isAudio:!0,chatLog:"/chat/record",init:{url:"/chat/init",data:{}},min:!0,members:{url:"/chat/groupMembers",type:"get",data:{}},tool:[{alias:"code",title:"代码",icon:"&#xe64e;"}]}),t.on("tool(code)",function(o){n.prompt({title:"插入代码",formType:2,shade:0},function(e,t){n.close(t),o("[pre class=layui-code]"+e+"[/pre]")})}),t.on("sign",function(e){console.log(e),$.ajax({url:"/Account/UpdateSign",type:"post",data:{sign:e}}).done(function(e){e.success||n.msg(e.msg)}).fail(function(e){console.info(e)})}),o.on("ReceiveMessage",function(e){e.timestamp=1e3*e.timestamp,t.getMessage(e)}),o.on("System",function(e){e.code<0?(console.log("%cchatHub:"+e.content,"color:#ff00ff"),o.stop()):0!==e.code||e.isGuest?1===e.code&&(n.msg(e.user.name+"上线了"),t.setFriendStatus(e.user.id,"online")):(n.msg(e.user.name+"下线了"),t.setFriendStatus(e.user.id,"offline"))}),t.on("sendMessage",function(e){"kefu"===e.to.id||("friend"===e.to.type?o.invoke("SendMessageToUser",e.to.id,e.mine.content).catch(function(e){return console.error(e.toString())}):"group"===e.to.type&&o.invoke("SendMessageToGroup",e.to.id,e.mine.content).catch(function(e){return console.error(e.toString())}))})});
//# sourceMappingURL=chat.min.js.map