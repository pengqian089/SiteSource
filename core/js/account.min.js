"use strict";layui.use(["table","form","upload","layer","element"],function(){let e=layui.table,o=layui.layer,t=layui.form,a=layui.upload,l=layui.element;if(e.init("myArticle-list",{toolbar:"default"}),e.init("myTalk-list",{toolbar:"default"}),e.init("myTimeline-list",{toolbar:"default"}),t.on("submit(account-info)",function(e){let t=o.load(1),a=$(e.form);return $.ajax({url:a.attr("action"),type:a.attr("method"),data:e.field}).done(function(e){e.success?o.msg("个人信息更新成功！"):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)}),!1}),t.on("submit(account-pass)",function(t){let e=o.load(1),a=$(t.form);return $.ajax({url:a.attr("action"),type:a.attr("method"),data:t.field}).done(function(e){e.success?(t.form.reset(),o.msg("密码修改成功！")):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(e)}),!1}),t.on("submit(account-net-easy)",function(t){let e=o.load(1),a=$(t.form);return $.ajax({url:a.attr("action"),type:a.attr("method"),data:t.field}).done(function(e){e.success?(t.form.reset(),o.msg("已发送请求")):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(e)}),!1}),a.render({elem:"#account-avatar",url:"/account/updateAvatar",accept:"images",acceptMime:"image/*",field:"avatar",done:function(e){e.success?($("#img-account-avatar").attr("src",e.data),o.msg("头像更新成功！")):o.msg(e.msg)},error:function(e){console.log(e)}}),"undefined"!=typeof editormd){let a={};for(var s in editormd.defaults)editormd.defaults.hasOwnProperty(s)&&(a[s]=editormd.defaults[s]);let i=null,n=null;const y=document.head.querySelector("meta[name=cdn-base-address]").content;l.on("tab(accountTab)",function(e){var t;$("#footer-submit").addClass("layui-btn-disabled").attr("disabled","disabled"),$("#friendship-submit").addClass("layui-btn-disabled").attr("disabled","disabled"),5===e.index?(t={width:"100%",height:"450px",watch:!1,toolbar:!1,codeFold:!0,searchReplace:!0,placeholder:"请输入页脚内容",value:$("#footer-content").val(),theme:"default",mode:"text/html",path:y+"/lib/editor.md/lib/",onload:function(){$("#footer-submit").removeClass("layui-btn-disabled").removeAttr("disabled"),window.matchMedia("(prefers-color-scheme: dark)").matches&&(this.setTheme("dark"),this.setEditorTheme("blackboard"),this.setPreviewTheme("dark"))}},t=$.extend(!0,{},a,t),i=editormd("footer-editor",t)):6===e.index&&(e={width:"100%",height:"450px",watch:!1,toolbar:!1,codeFold:!0,searchReplace:!0,placeholder:"请输入友情链接",value:$("#friendship-content").val(),theme:"default",mode:"text/html",path:y+"/lib/editor.md/lib/",onload:function(){$("#friendship-submit").removeClass("layui-btn-disabled").removeAttr("disabled"),window.matchMedia("(prefers-color-scheme: dark)").matches&&(this.setTheme("dark"),this.setEditorTheme("blackboard"),this.setPreviewTheme("dark"))}},e=$.extend(!0,{},a,e),n=editormd("friendship-editor",e))}),$(document).delegate("#footer-submit","click",function(){var e=i.getValue();let t=o.load(1);$.ajax({url:"/account/SaveFooter",type:"post",data:{content:e}}).done(function(e){e.success?o.msg("页脚内容更新成功！"):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})}),$(document).delegate("#friendship-submit","click",function(){var e=n.getValue();let t=o.load(1);$.ajax({url:"/account/SaveFriendship",type:"post",data:{content:e}}).done(function(e){e.success?o.msg("友情链接更新成功！"):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})}$(document).delegate(".preview[data-preview]","click",function(){var e=$(this).data("preview");o.open({type:2,title:"预览内容",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:e})});let i=document.querySelector("#my-article-list");function n(e){let t;e=o.open({type:2,title:"发布文章",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:"/article/publish/"+(void 0===e?"":e),success:function(e){t=window[e.find("iframe")[0].name]},end:function(){1===t.closeOrSuccess&&r()}});o.iframeAuto(e)}function r(){GridManager.refreshGrid("article-list")}null!=i&&(i.GM({gridManagerName:"article-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyArticle",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,cellHover:function(e,t,a){if(2===a)return{text:e.blogTitle}},columnData:[{key:"id",text:"id",isShow:!1},{key:"blogTitle",text:"标题",template:function(e,t){return`<a href="/article/read/${t.id}" target="_blank">${t.blogTitle}</a>`}},{key:"preview",text:"预览",template:function(e,t){return`<a href="javascript:;" class="preview" data-preview="/article/preview/${t.id}">预览</a>`}},{key:"commentCount",text:"回复量"},{key:"viewCount",text:"查看量"},{key:"tag",text:"标签"},{key:"lastUpdateTime",text:"最后修改时间",template:function(e,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",width:"118",template:function(e,t,a,i){return`<a href="javascript:;" style="margin-right: 5px" data-article-edit="${t.id}">修改</a> <a href="javascript:;" data-article-del="${t.id}">删除</a>`}}]}),$(document).delegate("[lay-filter=search-article]","click",function(){GridManager.setQuery("article-list",{title:$("#txtArticleTitle").val(),tag:$("#articleTag").val()})}),$(document).delegate("[lay-filter=publish-article]","click",function(){n()}),$(document).delegate("[data-article-edit]","click",function(){n($(this).data("articleEdit"))}),$(document).delegate("[data-article-del]","click",function(){let a=$(this).data("articleDel");o.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/article/delete",type:"post",data:{id:a}}).done(function(e){e.success?r():o.msg(e.msg)}).always(function(){o.close(t)})})}));let c=document.querySelector("#my-talk-list");function d(e){let t;e=o.open({type:2,title:"发布碎碎念",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:"/talk/publish/"+(void 0===e?"":e),success:function(e){t=window[e.find("iframe")[0].name]},end:function(){1===t.closeOrSuccess&&u()}});o.iframeAuto(e)}function u(){GridManager.refreshGrid("my-talk-list")}null!=c&&(c.GM({gridManagerName:"my-talk-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyTalk",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,fullColumn:{useFold:!0,fixed:"left",bottomTemplate:function(e){return`<pre style="padding: 5px; max-height: 600px;overflow-y: auto;width: 100%;margin-bottom: 15px;white-space: pre-wrap;font-weight: bold">${Prism.highlight(e.markdown,Prism.languages.markdown,"markdown")}</>`}},columnData:[{key:"id",text:"id",isShow:!1},{key:"markdown",text:"Markdown",template:function(e,t){return $("<p>").text(t.markdown).html()}},{key:"htmlContent",text:"HTML预览",template:function(e,t){return`<a href="javascript:;" class="preview" data-preview="/talk/preview/${t.id}">预览</a>`}},{key:"id",text:"查看回复",template:function(e,t){return`<a href="/account/talkComments/${t.id}">查看回复</a>`}},{key:"zan",text:"点赞数"},{key:"commentCount",text:"回复量"},{key:"createTime",text:"创建时间",template:function(e,t){return dayjs(t.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"lastUpdateTime",text:"最后修改时间",template:function(e,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",width:"100px",fixed:"right",template:function(e,t,a,i){return`<a href="javascript:;" style="margin-right: 5px" data-talk-edit="${t.id}">修改</a> <a href="javascript:;" data-talk-del="${t.id}">删除</a>`}}]}),$(document).delegate("[lay-filter=publish-talk]","click",function(){d()}),$(document).delegate("[data-talk-edit]","click",function(){d($(this).data("talkEdit"))}),$(document).delegate("[data-talk-del]","click",function(){let a=$(this).data("talkDel");o.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/talk/delete",type:"post",data:{id:a}}).done(function(e){e.success?u():o.msg(e.msg)}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})}),$(document).delegate("[lay-filter=search-talk]","click",function(){GridManager.setQuery("my-talk-list",{content:$("#txtTalkContent").val()})}));let m=document.querySelector("#my-talk-comment-list");if(null!=m){let i=$("#talkId").val();m.GM({gridManagerName:"talk-comment-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/talkComments/"+i,ajaxType:"get",height:"100%",supportCheckbox:!1,supportAjaxPage:!0,cellHover:function(e,t,a){if(2===a)return{text:e.content}},columnData:[{key:"id",text:"id",isShow:!1},{key:"content",text:"回复内容"},{key:"userName",text:"回复人",template:function(e,t){return t.nickName||t.commenter.name}},{key:"commentTime",text:"回复时间",template:function(e,t){return dayjs(t.commentTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",template:function(e,t,a,i){return` <a href="javascript:;" data-talk-comment-del="${t.id}">删除</a>`}}]}),$(document).delegate("[data-talk-comment-del]","click",function(){let a=$(this).data("talkCommentDel");o.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/account/deleteComment",type:"post",data:{talkId:i,commentId:a}}).done(function(e){e.success?GridManager.refreshGrid("talk-comment-list"):o.msg(e.msg)}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})})}let f=document.querySelector("#tb-music-library");if(null!=f){const x="music-library";f.GM({gridManagerName:x,ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/musicLibrary",ajaxType:"get",height:"100%",supportAjaxPage:!0,cellHover:function(e,t,a){switch(a){case 3:return{text:e.title};case 4:return{text:e.artist};case 5:return{text:e.fileName};case 6:return{text:e.from};case 7:return{text:(e.musicLength/1024/1024).toFixed(2)+"MB"};case 9:return{text:`${e.duration.hours.toString().padStart(2,"0")}:${e.duration.minutes.toString().padStart(2,"0")}:${e.duration.seconds.toString().padStart(2,"0")}.`+e.duration.milliseconds.toString()}}},rowRenderHandler:function(e,t){return e},columnData:[{key:"id",text:"id",isShow:!1},{key:"title",text:"歌曲名"},{key:"artist",text:"歌手"},{key:"fileName",text:"文件名"},{key:"from",text:"来源"},{key:"musicLength",text:"大小",template:function(e,t){return(t.musicLength/1024/1024).toFixed(2)+"MB"}},{key:"lyricsFileId",text:"歌词",template:function(e,t){return null==t.lyricsFileId?'<span style="color:red">没有歌词</span>':'<span style="color:green">有歌词</span>'}},{key:"duration",text:"时长",template:function(e,t,a,i){return`${t.duration.hours.toString().padStart(2,"0")}:${t.duration.minutes.toString().padStart(2,"0")}:${t.duration.seconds.toString().padStart(2,"0")}.`+t.duration.milliseconds.toString()}},{key:"action",text:"操作",width:"118",template:function(e,t,a,i){let n=`<a href="javascript:;" data-music-del="${t.id}">删除</a>`;return"网易云音乐"===t.from&&(n+=` <a href="javascript:;" data-music-save="${t.id}">保存</a>`),n}}]}),$(document).delegate("[data-music-del]","click",function(){let a=$(this).data("musicDel");o.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/music/delete",type:"post",data:{id:a}}).done(function(e){e.success?GridManager.refreshGrid(x):o.msg(e.msg)}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})}),$(document).delegate("[data-music-save]","click",function(){let a=$(this).data("musicSave");o.confirm("确定永久储存？储存后可以手动删除。",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/music/RecommendToDb",type:"post",data:{id:a}}).done(function(e){e.success?GridManager.refreshGrid(x):o.msg(e.msg)}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})}),$(document).delegate("[lay-filter=search-music-library]","click",function(){GridManager.setQuery(x,{title:$("#txtMusicTitle").val()})})}let p=document.querySelector("#my-timeline-list");function h(e){let t;e=o.open({type:2,title:"发布时间轴",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:"/timeline/publish/"+(void 0===e?"":e),success:function(e){t=window[e.find("iframe")[0].name]},end:function(){1===t.closeOrSuccess&&g()}});o.iframeAuto(e)}function g(){GridManager.refreshGrid("timeline-list")}null!=p&&(p.GM({gridManagerName:"timeline-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyTimeline",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,fullColumn:{useFold:!0,fixed:"left",bottomTemplate:function(e){return null===e.content?"":`<pre style="padding: 5px; max-height: 600px;overflow-y: auto;width: 100%;margin-bottom: 15px;white-space: pre-wrap;font-weight: bold">${Prism.highlight(e.content,Prism.languages.markdown,"markdown")}</pre>`}},cellHover:function(e,t,a){return 3===a?{text:e.title}:6===a?{text:e.more}:void 0},columnData:[{key:"id",text:"id",isShow:!1},{key:"title",text:"标题"},{key:"content",text:"内容",template:function(e,t){return $("<p>").text(t.content).html()}},{key:"date",text:"日期",template:function(e,t){return dayjs(t.date).format("YYYY-MM-DD")}},{key:"more",text:"更多链接"},{key:"createTime",text:"创建时间",template:function(e,t){return dayjs(t.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"lastUpdateTime",text:"最后修改时间",template:function(e,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",template:function(e,t,a,i){return`<a href="javascript:;" style="margin-right: 5px" data-timeline-edit="${t.id}">修改</a> <a href="javascript:;" data-timeline-del="${t.id}">删除</a>`}}]}),$(document).delegate("[lay-filter=add-timeline]","click",function(){h()}),$(document).delegate("[lay-filter=search-timeline]","click",function(){GridManager.setQuery("timeline-list",{content:$("#txtTimelineContent").val()})}),$(document).delegate("[data-timeline-edit]","click",function(){h($(this).data("timelineEdit"))}),$(document).delegate("[data-timeline-del]","click",function(){let a=$(this).data("timelineDel");o.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(e){o.close(e);let t=o.load(1);$.ajax({url:"/timeline/delete",type:"post",data:{id:a}}).done(function(e){e.success?g():o.msg(e.msg)}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(t)})})}))});
//# sourceMappingURL=account.js.map