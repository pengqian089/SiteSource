"use strict";layui.use(["table","form","upload","layer","element"],function(){let t=layui.table,n=layui.layer,i=layui.form,s=layui.upload,h=layui.element;t.init("myArticle-list",{toolbar:"default"});t.init("myTalk-list",{toolbar:"default"});t.init("myTimeline-list",{toolbar:"default"});i.on("submit(account-info)",function(t){let r=n.load(1),i=$(t.form);return $.ajax({url:i.attr("action"),type:i.attr("method"),data:t.field}).done(function(t){if(!t.success){n.msg(t.msg,{icon:2,anim:6});return}n.msg("个人信息更新成功！")}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(r)}),!1});i.on("submit(account-pass)",function(t){let r=n.load(1),i=$(t.form);return $.ajax({url:i.attr("action"),type:i.attr("method"),data:t.field}).done(function(i){if(!i.success){n.msg(i.msg,{icon:2,anim:6});return}t.form.reset();n.msg("密码修改成功！")}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(r)}),!1});i.on("submit(account-net-easy)",function(t){let r=n.load(1),i=$(t.form);return $.ajax({url:i.attr("action"),type:i.attr("method"),data:t.field}).done(function(i){if(!i.success){n.msg(i.msg,{icon:2,anim:6});return}t.form.reset();n.msg("已发送请求")}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(r)}),!1});if(s.render({elem:"#account-avatar",url:"/account/updateAvatar",accept:"images",acceptMime:"image/*",field:"avatar",done:function(t){if(!t.success){n.msg(t.msg);return}$("#img-account-avatar").attr("src",t.data);n.msg("头像更新成功！")},error:function(n){console.log(n)}}),typeof editormd!="undefined"){let t=null,i=null;h.on("tab(accountTab)",function(n){$("#footer-submit").addClass("layui-btn-disabled").attr("disabled","disabled");$("#friendship-submit").addClass("layui-btn-disabled").attr("disabled","disabled");n.index===5?t=editormd("footer-editor",{width:"100%",height:"450px",watch:!1,toolbar:!1,codeFold:!0,searchReplace:!0,placeholder:"请输入页脚内容",value:$("#footer-content").val(),theme:"default",mode:"text/html",path:"/lib/editor.md/lib/",onload:function(){$("#footer-submit").removeClass("layui-btn-disabled").removeAttr("disabled")}}):n.index===6&&(i=editormd("friendship-editor",{width:"100%",height:"450px",watch:!1,toolbar:!1,codeFold:!0,searchReplace:!0,placeholder:"请输入友情链接",value:$("#friendship-content").val(),theme:"default",mode:"text/html",path:"/lib/editor.md/lib/",onload:function(){$("#friendship-submit").removeClass("layui-btn-disabled").removeAttr("disabled")}}))});$(document).delegate("#footer-submit","click",function(){let i=t.getValue(),r=n.load(1);$.ajax({url:"/account/SaveFooter",type:"post",data:{content:i}}).done(function(t){if(!t.success){n.msg(t.msg,{icon:2,anim:6});return}n.msg("页脚内容更新成功！")}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(r)})});$(document).delegate("#friendship-submit","click",function(){let t=i.getValue(),r=n.load(1);$.ajax({url:"/account/SaveFriendship",type:"post",data:{content:t}}).done(function(t){if(!t.success){n.msg(t.msg,{icon:2,anim:6});return}n.msg("友情链接更新成功！")}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(r)})})}$(document).delegate(".preview[data-preview]","click",function(){let t=$(this).data("preview");n.open({type:2,title:"预览内容",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:t})});let r=document.querySelector("#my-article-list");if(r!=null){r.GM({gridManagerName:"article-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyArticle",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,cellHover:function(n,t,i){if(i===2)return{text:n.blogTitle}},columnData:[{key:"id",text:"id",isShow:!1},{key:"blogTitle",text:"标题",template:function(n,t){return`<a href="/article/read/${t.id}" target="_blank">${t.blogTitle}</a>`}},{key:"preview",text:"预览",template:function(n,t){return`<a href="javascript:;" class="preview" data-preview="/article/preview/${t.id}">预览</a>`}},{key:"commentCount",text:"回复量"},{key:"viewCount",text:"查看量"},{key:"tag",text:"标签"},{key:"lastUpdateTime",text:"最后修改时间",template:function(n,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",width:"118",template:function(n,t){return`<a href="javascript:;" style="margin-right: 5px" data-article-edit="${t.id}">修改</a> <a href="javascript:;" data-article-del="${t.id}">删除</a>`}}]});function t(t){let r,u=n.open({type:2,title:"发布文章",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:`/article/publish/${t===undefined?"":t}`,success:function(n){r=window[n.find("iframe")[0].name]},end:function(){r.closeOrSuccess===1&&i()}});n.iframeAuto(u)}function i(){GridManager.refreshGrid("article-list")}$(document).delegate("[lay-filter=search-article]","click",function(){GridManager.setQuery("article-list",{title:$("#txtArticleTitle").val(),tag:$("#articleTag").val()})});$(document).delegate("[lay-filter=publish-article]","click",function(){t()});$(document).delegate("[data-article-edit]","click",function(){let n=$(this).data("articleEdit");t(n)});$(document).delegate("[data-article-del]","click",function(){let t=$(this).data("articleDel");n.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(r){n.close(r);let u=n.load(1);$.ajax({url:"/article/delete",type:"post",data:{id:t}}).done(function(t){if(!t.success){n.msg(t.msg);return}i()}).always(function(){n.close(u)})})})}let u=document.querySelector("#my-talk-list");if(u!=null){u.GM({gridManagerName:"my-talk-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyTalk",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,fullColumn:{useFold:!0,fixed:"left",bottomTemplate:function(n){let t=hljs.highlight(n.markdown,{language:"markdown"});return`<pre style="padding: 5px; max-height: 600px;overflow-y: auto;width: 100%;margin-bottom: 15px;white-space: pre-wrap;font-weight: bold">${t.value}</>`}},columnData:[{key:"id",text:"id",isShow:!1},{key:"markdown",text:"Markdown",template:function(n,t){return $("<p>").text(t.markdown).html()}},{key:"htmlContent",text:"HTML预览",template:function(n,t){return`<a href="javascript:;" class="preview" data-preview="/talk/preview/${t.id}">预览</a>`}},{key:"id",text:"查看回复",template:function(n,t){return`<a href="/account/talkComments/${t.id}">查看回复</a>`}},{key:"zan",text:"点赞数"},{key:"commentCount",text:"回复量"},{key:"createTime",text:"创建时间",template:function(n,t){return dayjs(t.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"lastUpdateTime",text:"最后修改时间",template:function(n,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",width:"100px",fixed:"right",template:function(n,t){return`<a href="javascript:;" style="margin-right: 5px" data-talk-edit="${t.id}">修改</a> <a href="javascript:;" data-talk-del="${t.id}">删除</a>`}}]});function t(t){let r,u=n.open({type:2,title:"发布碎碎念",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:`/talk/publish/${t===undefined?"":t}`,success:function(n){r=window[n.find("iframe")[0].name]},end:function(){r.closeOrSuccess===1&&i()}});n.iframeAuto(u)}$(document).delegate("[lay-filter=publish-talk]","click",function(){t()});$(document).delegate("[data-talk-edit]","click",function(){let n=$(this).data("talkEdit");t(n)});$(document).delegate("[data-talk-del]","click",function(){let t=$(this).data("talkDel");n.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(r){n.close(r);let u=n.load(1);$.ajax({url:"/talk/delete",type:"post",data:{id:t}}).done(function(t){if(!t.success){n.msg(t.msg);return}i()}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(u)})})});$(document).delegate("[lay-filter=search-talk]","click",function(){GridManager.setQuery("my-talk-list",{content:$("#txtTalkContent").val()})});function i(){GridManager.refreshGrid("my-talk-list")}}let f=document.querySelector("#my-talk-comment-list");if(f!=null){let t=$("#talkId").val();f.GM({gridManagerName:"talk-comment-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:`/account/talkComments/${t}`,ajaxType:"get",height:"100%",supportCheckbox:!1,supportAjaxPage:!0,cellHover:function(n,t,i){if(i===2)return{text:n.content}},columnData:[{key:"id",text:"id",isShow:!1},{key:"content",text:"回复内容"},{key:"userName",text:"回复人",template:function(n,t){return t.nickName||t.commenter.name}},{key:"commentTime",text:"回复时间",template:function(n,t){return dayjs(t.commentTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",template:function(n,t){return` <a href="javascript:;" data-talk-comment-del="${t.id}">删除</a>`}}]});$(document).delegate("[data-talk-comment-del]","click",function(){let r=$(this).data("talkCommentDel");n.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(u){n.close(u);let f=n.load(1);$.ajax({url:"/account/deleteComment",type:"post",data:{talkId:t,commentId:r}}).done(function(t){if(!t.success){n.msg(t.msg);return}i()}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(f)})})});function i(){GridManager.refreshGrid("talk-comment-list")}}let e=document.querySelector("#tb-music-library");if(e!=null){const t="music-library";e.GM({gridManagerName:t,ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/musicLibrary",ajaxType:"get",height:"100%",supportAjaxPage:!0,cellHover:function(n,t,i){switch(i){case 3:return{text:n.title};case 4:return{text:n.artist};case 5:return{text:n.fileName};case 6:return{text:n.from};case 7:let t=(n.musicLength/1048576).toFixed(2)+"MB";return{text:t};case 9:let i=`${n.duration.hours.toString().padStart(2,"0")}:${n.duration.minutes.toString().padStart(2,"0")}:${n.duration.seconds.toString().padStart(2,"0")}.${n.duration.milliseconds.toString()}`;return{text:i}}},rowRenderHandler:function(n){return n},columnData:[{key:"id",text:"id",isShow:!1},{key:"title",text:"歌曲名"},{key:"artist",text:"歌手"},{key:"fileName",text:"文件名"},{key:"from",text:"来源"},{key:"musicLength",text:"大小",template:function(n,t){return(t.musicLength/1048576).toFixed(2)+"MB"}},{key:"lyricsFileId",text:"歌词",template:function(n,t){return t.lyricsFileId==null?'<span style="color:red">没有歌词<\/span>':'<span style="color:green">有歌词<\/span>'}},{key:"duration",text:"时长",template:function(n,t){return`${t.duration.hours.toString().padStart(2,"0")}:${t.duration.minutes.toString().padStart(2,"0")}:${t.duration.seconds.toString().padStart(2,"0")}.${t.duration.milliseconds.toString()}`}},{key:"action",text:"操作",width:"118",template:function(n,t){let i=`<a href="javascript:;" data-music-del="${t.id}">删除</a>`;return t.from==="网易云音乐"&&(i+=` <a href="javascript:;" data-music-save="${t.id}">保存</a>`),i}}]});$(document).delegate("[data-music-del]","click",function(){let i=$(this).data("musicDel");n.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(r){n.close(r);let u=n.load(1);$.ajax({url:"/music/delete",type:"post",data:{id:i}}).done(function(i){if(!i.success){n.msg(i.msg);return}GridManager.refreshGrid(t)}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(u)})})});$(document).delegate("[data-music-save]","click",function(){let i=$(this).data("musicSave");n.confirm("确定永久储存？储存后可以手动删除。",{icon:3,title:"提示"},function(r){n.close(r);let u=n.load(1);$.ajax({url:"/music/RecommendToDb",type:"post",data:{id:i}}).done(function(i){if(!i.success){n.msg(i.msg);return}GridManager.refreshGrid(t)}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(u)})})});$(document).delegate("[lay-filter=search-music-library]","click",function(){GridManager.setQuery(t,{title:$("#txtMusicTitle").val()})})}let o=document.querySelector("#my-timeline-list");if(o!=null){o.GM({gridManagerName:"timeline-list",ajaxHeaders:{"X-Requested-With":"XMLHttpRequest"},ajaxData:"/account/MyTimeline",ajaxType:"get",height:"100%",supportAjaxPage:!0,supportCheckbox:!1,fullColumn:{useFold:!0,fixed:"left",bottomTemplate:function(n){if(n.content===null)return"";let t=hljs.highlight(n.content,{language:"markdown"});return`<pre style="padding: 5px; max-height: 600px;overflow-y: auto;width: 100%;margin-bottom: 15px;white-space: pre-wrap;font-weight: bold">${t.value}</pre>`}},cellHover:function(n,t,i){return i===3?{text:n.title}:i===6?{text:n.more}:void 0},columnData:[{key:"id",text:"id",isShow:!1},{key:"title",text:"标题"},{key:"content",text:"内容",template:function(n,t){return $("<p>").text(t.content).html()}},{key:"date",text:"日期",template:function(n,t){return dayjs(t.date).format("YYYY-MM-DD")}},{key:"more",text:"更多链接"},{key:"createTime",text:"创建时间",template:function(n,t){return dayjs(t.createTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"lastUpdateTime",text:"最后修改时间",template:function(n,t){return dayjs(t.lastUpdateTime).format("YYYY-MM-DD HH:mm:ss")}},{key:"action",text:"操作",template:function(n,t){return`<a href="javascript:;" style="margin-right: 5px" data-timeline-edit="${t.id}">修改</a> <a href="javascript:;" data-timeline-del="${t.id}">删除</a>`}}]});function t(t){let r,u=n.open({type:2,title:"发布时间轴",shadeClose:!0,shade:[.8,"#393D49"],maxmin:!1,area:["90%","80%"],content:`/timeline/publish/${t===undefined?"":t}`,success:function(n){r=window[n.find("iframe")[0].name]},end:function(){r.closeOrSuccess===1&&i()}});n.iframeAuto(u)}function i(){GridManager.refreshGrid("timeline-list")}$(document).delegate("[lay-filter=add-timeline]","click",function(){t()});$(document).delegate("[lay-filter=search-timeline]","click",function(){GridManager.setQuery("timeline-list",{content:$("#txtTimelineContent").val()})});$(document).delegate("[data-timeline-edit]","click",function(){let n=$(this).data("timelineEdit");t(n)});$(document).delegate("[data-timeline-del]","click",function(){let t=$(this).data("timelineDel");n.confirm("删除后不可恢复，确定删除吗？",{icon:3,title:"提示"},function(r){n.close(r);let u=n.load(1);$.ajax({url:"/timeline/delete",type:"post",data:{id:t}}).done(function(t){if(!t.success){n.msg(t.msg);return}i()}).fail(function(t){t&&t.responseJSON&&t.responseJSON.success===!1&&n.alert(t.responseJSON.msg)}).always(function(){n.close(u)})})})}});
//# sourceMappingURL=account.min.js.map