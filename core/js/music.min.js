function musicInit(){let t=document.getElementsByClassName("song"),l=[],a=document.title,e=document.getElementsByClassName("amplitude-volume-slider")[0],i=50,n=0,s=2,u=20,o=document.getElementsByClassName("meta-lyrics")[0],r=new Map;void 0===localStorage["music-volume"]?localStorage["music-volume"]=e.value:(i=parseInt(localStorage["music-volume"]),e.value=isNaN(i)?50:i),e.addEventListener("change",function(){localStorage["music-volume"]=this.value});for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){this.querySelectorAll(".play-button-container")[0].style.display="none"}),l.push({name:t[e].dataset.title,artist:t[e].dataset.artist,album:"曲库音乐",url:t[e].dataset.url,cover_art_url:t[e].dataset.cover,visualization:"michaelbromley_visualization",lrc:t[e].dataset.lrc,time_callbacks:{0:function(){let e=Amplitude.getActiveSongMetadata();if(n=0,r.has(e.url))c(e.url);else{const t=new XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&(200<=t.status&&t.status<300||304===t.status?(r.set(e.url,function(e){{if(e){const r=(e=e.replace(/([^\]^\n])\[/g,(e,t)=>t+"\n[")).split("\n");let t=[];var l=r.length;for(let e=0;e<l;e++){var a=r[e].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),i=r[e].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(a){var n=a.length;for(let e=0;e<n;e++){var s=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(a[e]),u=60*s[1],o=parseInt(s[2]),s=s[4]?parseInt(s[4])/(2===(s[4]+"").length?100:1e3):0,s=u+o+s;t.push([s,i])}}}return t=t.filter(e=>e[1]),t.sort((e,t)=>e[0]-t[0]),t[t.length]=[t[t.length-1][0]+3,""],t}return[]}}(t.responseText)),c(e.url)):console.log("LRC file request fails: status "+t.status))},t.open("get",e.lrc,!0),t.send(null)}}}});function c(e){o.innerHTML="";var t,e=r.get(e);let l=document.createElement("ul");for(t of e){let e=document.createElement("li");e.innerHTML=t[1],l.appendChild(e)}o.appendChild(l),d()}function d(){const e=document.querySelectorAll(".meta-lyrics ul li");for(var t of e)t.classList.remove("active");0<e.length&&e[n].classList.add("active"),n>s&&(document.querySelectorAll(".meta-lyrics ul")[0].style.transform=`translateY(-${(n-s+2)*u}px)`)}Amplitude.init({songs:l,volume:i,callbacks:{play:function(){document.getElementById("album-art").style.visibility="hidden",document.getElementById("large-visualization").style.visibility="visible";var e=Amplitude.getActiveSongMetadata();document.title=`正在播放《${e.name}》 - ${e.artist} `+a},pause:function(){document.getElementById("album-art").style.visibility="visible",document.getElementById("large-visualization").style.visibility="hidden",document.title=a},timeupdate:function(){var e,t,l=Amplitude.getActiveSongMetadata();void 0!==r.get(l.url)?(e=r.get(l.url),t=event.path[0].currentTime,n!==e.length&&(function(t,e){var l=r.get(e);for(let e=n;e<l.length;e++)if(t<l[e+1][0]&&t>l[e][0]){n=e;break}}(t,l.url),d())):o.innerHTML="loading..."},seeked:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==r.get(e.url)){var t=event.path[0].currentTime,l=r.get(e.url);for(let e=0;e<l.length;e++)if(t<l[e+1][0]&&t<l[e][0]){n=e;break}}}},waveforms:{sample_rate:100},visualization:"michaelbromley_visualization",visualizations:[{object:MichaelBromleyVisualization,params:{}}]}),document.getElementById("large-visualization").style.height=document.getElementById("album-art").offsetWidth+"px"}$(function(){var e=$("meta[name=cdn-base-address]").attr("content");"undefined"==typeof Amplitude?$.when($.getScript(e+"/lib/amplitudejs/amplitude.min.js"),$.getScript(e+"/lib/amplitudejs/visualizations/michaelbromley.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){musicInit()}):musicInit(),$(document).on("pjax:send",function(){Amplitude?.stop()})});
//# sourceMappingURL=music.min.js.map