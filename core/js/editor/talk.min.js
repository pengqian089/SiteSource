var closeOrSuccess=0;layui.use(["table","form","layer"],function(){let o=layui.layer,l=null,i=[],s=-1,a=parent.layer.getFrameIndex(window.name),d=editormd("editor",{htmlDecode:"script,iframe|on*",width:"99%",height:$(document).height()-20-38,theme:"dark",saveHTMLToTextarea:!0,imageUpload:!0,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"/Talk/Upload",path:"/lib/editor.md/lib/",onload:function(){},toolbarIcons:function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","html-entities","pagebreak","|","goto-line","watch","preview","clear","search","|","record"]},toolbarIconTexts:{record:"录音"},toolbarHandlers:{record:function(e,a,t,d){navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{$.notify("麦克风已授权","success"),s=o.open({type:1,title:"录音",content:$("#recorder"),success:function(){l=new MediaRecorder(e),l.addEventListener("dataavailable",e=>{i.push(e.data)})},end:function(){s=-1,n()}})}).catch(function(){$.notify("麦克风已被用户拒绝授权","error")})}},lang:{toolbar:{record:"录音"}}});function n(){i=[],$("#playAudio,#clearAudio,#uploadAudio").addClass("layui-btn-disabled").attr("disabled","disabled"),$("#recordAudio").removeClass("layui-btn-disabled").removeAttr("disabled").data("start","false").text("开始录制")}$("#save").click(function(){if(d.getMarkdown().length<5)o.msg("这么点?",{icon:2,anim:6});else{let e=o.load(1);$.ajax({url:"/Talk/Publish",data:{markdown:d.getMarkdown(),html:d.getHTML(),id:$("#Id").val()},type:"post"}).done(function(e){e.success?(parent.layer.close(a),closeOrSuccess=1):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(e)})}}),$("#cancel").click(function(){parent.layer.close(a),closeOrSuccess=0}),$(document).delegate("#recordAudio","click",function(){null!=l&&("true"===$(this).data("start")?($("#recordAudio").text("开始录制").addClass("layui-btn-disabled").attr("disabled","disabled").data("start","false"),l.stop(),$("#playAudio,#clearAudio,#uploadAudio").removeClass("layui-btn-disabled").removeAttr("disabled")):($("#recordAudio").text("停止录制").removeClass("layui-btn-disabled").removeAttr("disabled").data("start","true"),l.start()))}),$(document).delegate("#playAudio","click",function(){if(0!==i.length){var e=new Blob(i),e=URL.createObjectURL(e);const a=new Audio(e);a.addEventListener("play",function(){$("#playAudio").text("正在试听").addClass("layui-btn-disabled").attr("disabled","disabled"),$("#clearAudio,#uploadAudio").addClass("layui-btn-disabled").attr("disabled","disabled")}),a.addEventListener("ended",function(){$("#playAudio").text("试听").removeClass("layui-btn-disabled").removeAttr("disabled","disabled"),$("#clearAudio,#uploadAudio").removeClass("layui-btn-disabled").removeAttr("disabled","disabled")}),a.play()}}),$(document).delegate("#clearAudio","click",function(){n()}),$(document).delegate("#uploadAudio","click",function(){if(0!==i.length&&-1!==s){let e=o.load(1);var t=new Blob(i);let a=new FormData;a.append("record",t,`${(new Date).getTime()}.wav`),$.ajax({url:"/Audio/Upload",type:"post",cache:!1,contentType:!1,processData:!1,data:a}).done(function(e){e.success?(d.insertValue(`<audio controls src="/Audio/Result/${e.data.id}" preload="metadata"></audio>`),o.close(s)):o.msg(e.msg,{icon:2,anim:6})}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&o.alert(e.responseJSON.msg)}).always(function(){o.close(e)})}})}),DarkReader.auto({brightness:100,contrast:90,sepia:10});
//# sourceMappingURL=talk.min.js.map