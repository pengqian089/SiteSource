let dpzOption={webApiBaseAddress:document.head.querySelector("meta[name=web-api-base-address]").content,CDNBaseAddress:document.head.querySelector("meta[name=cdn-base-address]").content,isDark:!1};function leftIn(){$(".blog-mask").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-nav-left").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-mask").removeClass("maskOut"),$(".blog-mask").addClass("maskIn"),$(".blog-mask").removeClass("layui-hide"),$(".blog-mask").addClass("layui-show"),$(".blog-nav-left").removeClass("leftOut"),$(".blog-nav-left").addClass("leftIn"),$(".blog-nav-left").removeClass("layui-hide"),$(".blog-nav-left").addClass("layui-show")}function leftOut(){$(".blog-mask").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-mask").addClass("layui-hide")}),$(".blog-nav-left").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-nav-left").addClass("layui-hide")}),$(".blog-mask").removeClass("maskIn"),$(".blog-mask").addClass("maskOut"),$(".blog-mask").removeClass("layui-show"),$(".blog-nav-left").removeClass("leftIn"),$(".blog-nav-left").addClass("leftOut"),$(".blog-nav-left").removeClass("layui-show")}function categroyIn(){$(".category-toggle").addClass("layui-hide"),$(".article-category").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".article-category").removeClass("categoryOut"),$(".article-category").addClass("categoryIn"),$(".article-category").addClass("layui-show")}function categoryOut(){$(".article-category").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".article-category").removeClass("layui-show"),$(".category-toggle").removeClass("layui-hide")}),$(".article-category").removeClass("categoryIn"),$(".article-category").addClass("categoryOut")}function lightCode(){document.querySelectorAll("pre code").forEach(e=>{Prism.highlightElement(e)}),codeBlockTools()}function codeBlockTools(){$("pre[class*=language-]").wrap('<div class="code-area" style="position: relative"></div>');var e=$('<i class="fa fa-angle-up fa-fw code-expand" aria-hidden="true" title="折叠"></i>');$(".code-area").prepend(e),$(".code-expand").on("click",function(){$(this).parent().hasClass("code-closed")?($(this).siblings("pre").find("code").show(),$(this).siblings("pre").find(".line-highlight").show(),$(this).parent().removeClass("code-closed")):($(this).siblings("pre").find("code").hide(),$(this).siblings("pre").find(".line-highlight").hide(),$(this).parent().addClass("code-closed"))});var t=$('<i class="fa fa-copy fa-fw code_copy" title="复制代码" aria-hidden="true"></i>'),e=$('<div class="codecopy_notice"></div>');$(".code-area").prepend(t),$(".code-area").prepend(e),$(".code-area .fa-copy").on("click",function(){let e=window.getSelection(),t=document.createRange();t.selectNodeContents($(this).siblings("pre").find("code")[0]),e.removeAllRanges(),e.addRange(t);e.toString();!function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy"),layer.msg("复制成功")}catch(e){return layer.msg("复制失败")}else layer.msg("浏览器不支持")}(),e.removeAllRanges()});e=$('<div class="code_lang" title="代码语言"></div>');$("pre").before(e),$("pre").each(function(){var e;for(e of $(this).prop("class").split(/\s+/))if(e.startsWith("language")){var t=e.replace("language-","").trim();$(this).siblings(".code_lang").text(t);break}})}function generateToc(){let e=$(".js-toc");if(0!==e.length)return 0===$(".article-detail-content").find("h1,h2,h3").length?(tocbot.destroy(),$("label.toc-icon.menu").hide(),void e.hide()):void tocbot.init({tocSelector:".js-toc",contentSelector:".article-detail-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})}function pjaxCompleteInit(){lightCode(),generateToc(),$("time.timeago").timeago(),initVideoPlayer(),initFetchContent()}function showNotify(e){var t={title:"",content:"",image:"/images/logo.png"};return $.extend(t,e),"Notification"in window&&"granted"===Notification.permission?new Notification(t.title,{icon:t.image,body:t.content,lang:"zh-cn",tag:t.tag}):null}function loadImages(t){let n=[];for(let e=0;e<t.length;e++){let o=t[e];var a=new Promise((e,t)=>{o.complete?e(o):(o.addEventListener("load",function(){(o.complete?e:t)(o)}),o.addEventListener("error",function(){console.warn(`the image [${o.src}] loaded error.`),t(o)}))});n.push(a)}return Promise.all(n)}function topicHideMore(e){e.each(function(e){let t=this;var o=$(this).find("img");function n(){500<$(t).height()&&($(t).addClass("hide-content"),$(t).parents(".blog-module.shadow").find(".more").removeClass("hide"))}0<o.length?loadImages(o).finally(()=>n()):n()})}window.matchMedia("(prefers-color-scheme: dark)").matches&&(dpzOption.isDark=!0),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let o=layui.element,l=layui.layer,e=(layui.carousel,layui.flow),t=layui.util;t.fixbar({bar1:"&#xe64a;",css:{bottom:55},click:function(e){if("bar1"===e){let e=l.load();console.log(event),$.ajax({url:"/Home/TodayWallpaper"}).done(function(e){let t=[];for(var o of e)t.push({src:o.url.replaceAll("1920x1080","UHD"),w:1920,h:1080,title:o.copyRight});e={index:0,bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){let t=document.querySelectorAll(".layui-fixbar [lay-type=bar1]")[e];var o=window.pageYOffset||document.documentElement.scrollTop,e=t.getBoundingClientRect();return{x:e.left,y:e.top+o,w:e.width}}};let n=new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,t,e);n.init()}).always(function(){l.close(e)})}}}),e.lazyimg();let n=new LazyLoad({});if(!1===layui.device().mobile)try{const w=document.querySelector("#can-back-round");var a=w.getBoundingClientRect();w.width=a.width,w.height=a.height;const k=new RaindropFX({canvas:w,background:dpzOption.isDark?dpzOption.CDNBaseAddress+"/../images/core-backg-dark.jpeg":dpzOption.CDNBaseAddress+"/../images/background.jpg"});window.onresize=()=>{var e=w.getBoundingClientRect();k.resize(e.width,e.height)},k.start()}catch(e){console.log(e)}function i(e,t){let o=new TencentCaptcha("2084420298",function(e){console.log(e),0===e.ret&&t(e)},{bizState:e,enableDarkMode:!0,needFeedBack:!0});o.show()}$.ajax({url:"/account/GetUserInfo"}).done(function(e){e.success&&$(".blog-user").attr("href","/account").find("img").attr({src:e.data.avatar+"?width=40&height=40",title:e.data.name})}).fail(ajaxFail),$(document).delegate(".blog-navicon","click",function(){let e=new RegExp("layui-hide");(e.test($(".blog-nav-left").attr("class"))?leftIn:leftOut)()}),$(document).delegate(".blog-mask","click",function(){leftOut()}),$(document).delegate(".category-toggle","click",function(){categroyIn()}),$(document).delegate(".article-category","click",function(){categoryOut()}),$(document).delegate(".article-category > a","click",function(){$(".article-category > a").removeClass("tag-this"),$(this).addClass("tag-this")}),$(document).on("pjax:send",function(){NProgress.start()}),$(document).on("pjax:complete",function(e,t){document.title=Base64.decode(t.getResponseHeader("title")),o.render(),categoryOut(),leftOut(),pjaxCompleteInit(),NProgress.done()}),$(document).on("pjax:end",function(){s=$("#topic-comments"),d=s.data("topicId"),r=parseInt(s.data("commentSize")),u=parseInt(s.data("commentStartPage")),m=parseInt(s.data("totalPage")),g=s.data("commentSort"),n.update()}),$(document).delegate("[data-likeid]","click",function(){let t=$(this),e=l.load(1);$.ajax({url:"/Talk/Like",data:{id:t.data("likeid")},type:"post"}).done(function(e){e.success?t.find("[data-number]").text(e.data):l.msg(e.msg,{icon:2,anim:6})}).always(function(){l.close(e)})}),$(document).delegate("[data-comment-id]","click",function(){let n=$(this),a=n.parents("div.comment-parent").find("div.comments[data-talk-id]");if(0<a.find("form").length)a.hide(100,function(){a.html("")});else{$("div.comment-parent div.comments[data-talk-id] div.comment-container").hide(function(){$(this).html("")});let e=l.load(1);$.ajax({url:"/Talk/GetComments",data:{id:n.data("commentId")},type:"get"}).done(function(e,t,o){n.find("[data-comment-count]").text(o.getResponseHeader("itemCount")),a.html(e),lightCode(),a.show()}).always(function(){l.close(e)})}}),$(document).delegate("button[data-btn-comment]","click",function(e){let t=$(this).parents("form")[0],o=new FormData(t),a=$(this);function n(){let e=l.load(1),n=a.data("btnComment");$.ajax({processData:!1,contentType:!1,url:t.getAttribute("action"),data:o,type:t.getAttribute("method")}).done(function(e){if(e.success){let e=l.load(1);$.ajax({url:"/Talk/GetComments",data:{id:n},type:"get"}).done(function(e,t,o){$(`[data-comment-id=${n}]`).find("[data-comment-count]").text(o.getResponseHeader("itemCount")),a.parents(".comment-parent").find(".comments[data-talk-id]").html(e)}).always(function(){l.close(e)})}else l.msg(e.msg,{icon:2,anim:6})}).always(function(){l.close(e)})}"no-login"!==$("#loginStatus").val()?n():i(a.data("scene"),function(e){o.append("ticket",e.ticket),o.append("randstr",e.randstr),o.append("scene",e.bizState),n()})}),$(document).delegate("#comment-pager a[href]","click",function(e){e.preventDefault();let t=$(this);e=$(this).attr("href");let o=l.load(1);$.ajax({url:e,type:"get"}).done(function(e){t.parents(".comment-parent").find(".comments[data-talk-id]").html(e),lightCode()}).always(function(){l.close(o)})});let c=".article.shadow .article-left img,#talk-list>ul>li .content-detail .content img,.article-detail-content img,#cd-timeline .content img";$(document).delegate(c,"click",function(){let e=l.load(1),i=$(c);loadImages(i).then(t=>{let o=[];for(let e=0;e<t.length;e++){var n=t[e];o.push({src:n.src,w:n.naturalWidth,h:n.naturalHeight,title:n.alt})}var e={index:i.index(this),bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){let t=document.querySelectorAll(c)[e];var o=window.pageYOffset||document.documentElement.scrollTop,e=t.getBoundingClientRect();return{x:e.left,y:e.top+o,w:e.width}}};let a=new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,o,e);a.init()}).finally(()=>l.close(e))}),$(document).delegate("form.layui-form[data-load-page]","submit",function(e){e.preventDefault();let t=new FormData(this),o=$(this).data("loadPage"),n=$(this);function a(){let e=l.load(1);$.ajax({url:"/article/comment",processData:!1,contentType:!1,data:t,type:"post"}).done(function(e){e.success?($("textarea").val(""),$.pjax({url:o,container:"#blog-comment",scrollTo:!1})):l.msg(e.msg,{icon:2,anim:6})}).always(function(){l.close(e)})}"no-login"!==$(this).data("login")?a():i(n.data("scene"),function(e){t.append("ticket",e.ticket),t.append("randstr",e.randstr),t.append("scene",e.bizState),a()})}),$(document).delegate(".content-detail .more a","click",function(){let e=$(this).parents(".more"),t=$(this).parents(".content-detail").find(".content");e.hasClass("show-more")?(e.removeClass("show-more"),t.addClass("hide-content"),$(this).html('查看更多<i class="layui-icon layui-icon-down">')):(e.addClass("show-more"),t.removeClass("hide-content"),$(this).html('收起<i class="layui-icon layui-icon-up">'))}),$(document).delegate("#i-search","submit",function(){var e=$("#i-keyword").val();let t=$(this).find("[name=q]");$(this).find("[name=q]").val(t.data("default")+" "+e)}),$(document).delegate("#i-keyword","keyup",function(e){13===e.keyCode&&$(this).parents("form").submit()}),$(document).delegate("#i-search a.search-btn","click",function(){$(this).parents("form").submit()}),$(document).delegate(".blog-module.shadow .more a","click",function(){let e=$(this).parents(".more"),t=$(this).parents(".blog-module.shadow").find(".topic");e.hasClass("show-more")?(e.removeClass("show-more"),t.addClass("hide-content"),$(this).html('查看更多<i class="layui-icon layui-icon-down">')):(e.addClass("show-more"),t.removeClass("hide-content"),$(this).html('收起<i class="layui-icon layui-icon-up">'))}),$(document).delegate("a[data-topic-delete]","click",function(){let o=$(this).data("topicDelete");l.confirm("删除后不可恢复，是否删除？",function(e){l.close(e);let t=l.load();$.ajax({url:"/topic/deleteTopic",data:{id:o},type:"post"}).done(function(e){e.success?$.pjax({url:location.pathname,container:".blog-main-left",scrollTo:!0}):l.msg(e.msg,{icon:2,anim:6})}).always(function(){l.close(t)}).fail(ajaxFail)})}),$(document).delegate("a[data-topic-comment-delete]","click",function(){let o=$(this).data("topicCommentDelete");l.confirm("删除后不可恢复，是否删除？",function(e){l.close(e);let t=l.load();$.ajax({url:"/topic/deleteComment",data:{id:o},type:"post"}).done(function(e){e.success?$.pjax({url:location.pathname,container:".blog-body",scrollTo:!0}):l.msg(e.msg,{icon:2,anim:6})}).always(function(){l.close(t)}).fail(ajaxFail)})}),0<window.scrollY&&$(".blog-nav").css({"background-color":"rgba(57,61,73,.5)","backdrop-filter":"blur(100px)"});let s=$("#topic-comments"),d=s.data("topicId"),r=parseInt(s.data("commentSize")),u=parseInt(s.data("commentStartPage")),m=parseInt(s.data("totalPage")),g=s.data("commentSort"),f=!1;let p=null,h=$(window),b=$(document);function y(e){clearTimeout(p),p=setTimeout(function(){0<window.scrollY?$(".blog-nav").css({"background-color":"rgba(57,61,73,.5)","backdrop-filter":"blur(100px)"}):0===window.scrollY&&$(".blog-nav").css({"background-color":"rgb(57,61,73)","backdrop-filter":"none"}),0===s.length||u>m||h.scrollTop()+h.height()>b.height()-120&&!0!==f&&(f=!0,$("#topic-comment-loading").show(),$.ajax({url:"/topic/commentPage",data:{id:d,pageIndex:u,pageSize:r,sort:g},type:"get"}).done(function(e){u++;let t=$(e);$("#topic-comments").append(t),t.find("time.timeago").timeago(),t.find("pre code").each(function(e,t){Prism.highlightElement(block)}),topicHideMore(t.find(".article-detail-content.topic")),n.update()}).always(function(){f=!1,$("#topic-comment-loading").hide()}).fail(function(e){e&&e.responseJSON&&!1===e.responseJSON.success&&l.alert(e.responseJSON.msg)}))},100)}h.off("scroll",y).on("scroll",y)}),$(function(){$.pjax.defaults.timeout=2e4,$(document).pjax("nav.blog-nav ul.layui-nav>li>a,a[data-pjax]",".blog-body"),$(document).pjax("#blog-list a,.tags a",".blog-main-left"),$(document).pjax("#articl-comment a","#blog-comment",{scrollTo:!1}),$(document).pjax("#talk-pager a","#talk-list"),$(document).pjax("#topic-list a",".blog-main-left"),$(document).pjax(".code-box .box-rows .row .header a",".code-box .box-rows"),$.support.pjax&&$(".tags a").on("click",function(e){$(".tags a").removeClass("tag-this"),$(this).addClass("tag-this");$.pjax.click(e,{container:".blog-main-left"})}),pjaxCompleteInit()}),codeBlockTools(),function(){const t=new APlayer({container:document.getElementById("aplayer"),lrcType:3,fixed:!0});$.ajax("/Music/Recommend").done(function(e){t.list.add(e)}),"granted"!==Notification.permission&&Notification.requestPermission(function(e){"granted"===e&&console.info("通知已授权")});let o=0,e=(new signalR.HubConnectionBuilder).withUrl("/notification").build();e.start().then(()=>{e.invoke("Init").catch(function(e){return console.error(e.toString())})}).catch(e=>console.error(e.toString())),e.on("pushMusic",function(e){t.list.add(e),t.list.switch(t.list.audios.length-1)}),e.on("pushMessage",function(e){let t=showNotify({title:"小喇叭开始广播辣",content:e.markdown});null!==t&&(t.onclick=function(){window.open("/talk.html")}),console.info(e)}),e.on("pushLogMessage",function(e,t){0===e?(console.log(`%c LogMessage %c [${(new Date).toISOString()}]  %c `+t,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #77f2e1; padding:5px 0;"),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"success")):1===e?(console.log(`%c LogMessage %c [${(new Date).toISOString()}]  %c `+t,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #fadfa3; padding:5px 0;"),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"warn")):2===e&&(console.log(`%c LogMessage %c [${(new Date).toISOString()}]  %c `+t,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: red; padding:5px 0;"),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"error"))});let a=null;e.on("cnBetaSubscribe",function(t){let o=[];if(t.hasOwnProperty("progressValues")&&Array.isArray(t.progressValues))for(let e=0;e<t.progressValues.length;e++){var n=(100*t.progressValues[e]).toFixed(2);o.push(parseFloat(n))}switch(null==a?a=notification.show({title:"CnBeta发布",content:t.message,bars:o}):(notification.setContent(a,t.message),notification.setProgress(a,o)),t.type){case 0:outPutSuccess(t.message);break;case 1:outPutInfo(t.message);break;case 2:outPutError(t.message);break;case 3:outPutSuccess(t.message),setTimeout(function(){notification.close(a),a=null},1e3)}});let i=null;e.on("hotTopicMessage",function(t){let o=[];if(t.hasOwnProperty("progressValues")&&Array.isArray(t.progressValues))for(let e=0;e<t.progressValues.length;e++){var n=(100*t.progressValues[e]).toFixed(2);o.push(parseFloat(n))}null==i?i=notification.show({title:"今日热榜发布",content:t.message,bars:o}):(notification.setContent(i,t.message),notification.setProgress(i,o),3===t.type&&setTimeout(function(){notification.close(i),i=null},1e3)),outPutSuccess(t.message)}),e.on("ready",function(e){console.info(e)}),e.on("ReceiveRunTime",function(e){let t=$("#runTime");0<t.length&&t.text("运行时间 "+e)}),e.onclose(async()=>{o++,await async function t(){try{await e.start(),o=0,console.log("connected")}catch(e){10<o&&(console.log("try connect 10"),console.log(e)),console.log(e),setTimeout(()=>t(),3e3)}}()})}();let notification={show:function(e){"object"!=typeof e&&(e={});let s={title:"",content:"",bars:[]};$.extend(s,e);let t=0;$(".notification-box").each(function(){t+=$(this).height()+15});let o=function(e,t){let o=$("<div>").addClass("notification-box"),n=$("<div>").addClass("title").text(e);o.append(n);let a=$("<div>").addClass("content-container"),i=$("<span>").addClass("content").text(t);a.append(i);var l=function(t){let o=[];if(!Array.isArray(t))return o;for(let e=0;e<t.length;e++)"number"==typeof t[e]&&o.push(t[e]);return o}(s.bars);for(let t=0;t<l.length;t++){let e=$("<div>").addClass("progress");var c=l[t]+"%",c=$("<div>").addClass("bar").css("width",c).text(c);e.append(c),a.append(e)}return o.append(a),o}(s.title,s.content);return o.css("top",t+15+"px"),$("body").append(o),o},setContent:function(e,t){0!==e.length&&e.find(".content").text(t)},setTitle:function(e,t){0!==e.length&&e.find(".title").text(t)},setProgress:function(o,n){if(0!==o.length&&Array.isArray(n)){let t=0;for(let e=0;e<n.length;e++)"number"==typeof n[e]&&(o.find(`.content-container .progress:eq(${t}) .bar`).css("width",n[e]+"%").text(n[e]+"%"),t++)}},close:function(e){0!==e.length&&e.fadeOut("fast",function(){e.remove()})},closeAll:function(){$(".notification-box").fadeOut("fast",function(){$(".notification-box").remove()})},test:function(){let t=notification.show({title:"这是标题呀",content:"内容",bars:[0]});setTimeout(function e(){if(100<=o)return notification.setContent(t,"加载完毕，即将关闭！"),void notification.close(t);o++;notification.setContent(t,"新内容呀\n"+o);notification.setProgress(t,[o]);setTimeout(e,100)},100);let o=0}};function outPutSuccess(e){console.log(`%c Success %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #77f2e1; padding:5px 0;")}function outPutInfo(e){console.log(`%c Info %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #fadfa3; padding:5px 0;")}function outPutError(e){console.log(`%c Error %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: red; padding:5px 0;")}function ajaxFail(e,t,o){console.log(e),console.log(t),console.log(o),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("success")&&e.responseJSON.hasOwnProperty("msg")&&!1===e.responseJSON.success?layer.alert(e.responseJSON.msg):layer.msg("error:"+e.status)}async function initVideoPlayer(){const t=document.getElementById("video-player")||document.getElementById("m-video-player");if(null!=t){t.style.marginBottom="15px";let e=await fetch(dpzOption.webApiBaseAddress+"/api/Video",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});var o=await e.json(),n=Math.floor(Math.random()*o.length);new DPlayer({container:document.getElementById(t.id),danmaku:{api:"/history/chat/",id:o[n].id,maximum:2e3,token:"tokendemo",user:"阿胖",bottom:"15%"},video:{url:o[n].m3u8,type:"hls"}})}}async function initFetchContent(){for(let t of document.querySelectorAll("[data-request]")){let e=await fetch(t.dataset.request,{method:"GET"});e.text().then(e=>t.innerHTML=e)}}
//# sourceMappingURL=site.min.js.map