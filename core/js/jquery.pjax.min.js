/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(n){function it(t,i,r){r=e(i,r);return this.on("click.pjax",t,function(t){var i=r;i.container||(i=n.extend({},r),i.container=n(this).attr("data-pjax"));v(t,i)})}function v(i,r,u){var f,o;if(u=e(r,u),f=i.currentTarget,o=n(f),f.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(i.which>1)&&!i.metaKey&&!i.ctrlKey&&!i.shiftKey&&!i.altKey&&location.protocol===f.protocol&&location.hostname===f.hostname&&(!(f.href.indexOf("#")>-1)||d(f)!=d(location))&&!i.isDefaultPrevented()){var c={url:f.href,container:o.attr("data-pjax"),target:f},s=n.extend({},c,u),h=n.Event("pjax:click");o.trigger(h,[s]);h.isDefaultPrevented()||(t(s),i.preventDefault(),o.trigger("pjax:clicked",[s]))}}function rt(i,r,u){var s,o,f;if(u=e(r,u),s=i.currentTarget,o=n(s),s.tagName.toUpperCase()!=="FORM")throw"$.pjax.submit requires a form element";if(f={type:(o.attr("method")||"GET").toUpperCase(),url:o.attr("action"),container:o.attr("data-pjax"),target:s},f.type!=="GET"&&window.FormData!==undefined)f.data=new FormData(s),f.processData=!1,f.contentType=!1;else{if(o.find(":file").length)return;f.data=o.serializeArray()}t(n.extend({},f,u));i.preventDefault()}function t(i){function u(t,r,u){u||(u={});u.relatedTarget=i.target;var f=n.Event(t,u);return o.trigger(f,r),!f.isDefaultPrevented()}var e,h,o,c,s;if(i=n.extend(!0,{},n.ajaxSettings,t.defaults,i),n.isFunction(i.url)&&(i.url=i.url()),e=f(i.url).hash,h=n.type(i.container),h!=="string")throw"expected string value for 'container' option; got "+h;if(o=i.context=n(i.container),!o.length)throw"the container selector '"+i.container+"' did not match anything";return i.data||(i.data={}),n.isArray(i.data)?i.data.push({name:"_pjax",value:i.container}):i.data._pjax=i.container,i.beforeSend=function(n,t){if(t.type!=="GET"&&(t.timeout=0),n.setRequestHeader("X-PJAX","true"),n.setRequestHeader("X-PJAX-Container",i.container),!u("pjax:beforeSend",[n,t]))return!1;t.timeout>0&&(c=setTimeout(function(){u("pjax:timeout",[n,i])&&n.abort("timeout")},t.timeout),t.timeout=0);var r=f(t.url);e&&(r.hash=e);i.requestUrl=k(r)},i.complete=function(n,t){c&&clearTimeout(c);u("pjax:complete",[n,t,i]);u("pjax:end",[n,i])},i.error=function(n,t,f){var e=g("",n,i),o=u("pjax:error",[n,t,f,i]);i.type=="GET"&&t!=="abort"&&o&&r(e.url)},i.success=function(s,h,c){var tt=t.state,b=typeof n.pjax.defaults.version=="function"?n.pjax.defaults.version():n.pjax.defaults.version,k=c.getResponseHeader("X-PJAX-Version"),l=g(s,c,i),d=f(l.url),nt,a,v,y,p;if(e&&(d.hash=e,l.url=d.href),b&&k&&b!==k){r(l.url);return}if(!l.contents){r(l.url);return}if(t.state={id:i.id||w(),url:l.url,title:l.title,container:i.container,fragment:i.fragment,timeout:i.timeout},(i.push||i.replace)&&window.history.replaceState(t.state,l.title,l.url),nt=n.contains(o,document.activeElement),nt)try{document.activeElement.blur()}catch(it){}l.title&&(document.title=l.title);u("pjax:beforeReplace",[l.contents,i],{state:t.state,previousState:tt});o.html(l.contents);a=o.find("input[autofocus], textarea[autofocus]").last()[0];a&&document.activeElement!==a&&a.focus();ot(l.scripts);v=i.scrollTo;e&&(y=decodeURIComponent(e.slice(1)),p=document.getElementById(y)||document.getElementsByName(y)[0],p&&(v=n(p).offset().top));typeof v=="number"&&n(window).scrollTop(v);u("pjax:success",[s,h,c,i])},t.state||(t.state={id:w(),url:window.location.href,title:document.title,container:i.container,fragment:i.fragment,timeout:i.timeout},window.history.replaceState(t.state,document.title)),p(t.xhr),t.options=i,s=t.xhr=n.ajax(i),s.readyState>0&&(i.push&&!i.replace&&(st(t.state.id,[i.container,b(o)]),window.history.pushState(null,"",i.requestUrl)),u("pjax:start",[s,i]),u("pjax:send",[s,i])),t.xhr}function ut(i,r){var u={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return t(n.extend(u,e(i,r)))}function r(n){window.history.replaceState(null,"",t.state.url);window.location.replace(n)}function y(f){var s,e,c,y,h,w;if(u||p(t.xhr),s=t.state,e=f.state,e&&e.container){if(u&&ft==e.url)return;if(s){if(s.id===e.id)return;c=s.id<e.id?"forward":"back"}var v=i[e.id]||[],l=v[0]||e.container,o=n(l),a=v[1];o.length?(s&&ht(c,s.id,[l,b(o)]),y=n.Event("pjax:popstate",{state:e,direction:c}),o.trigger(y),h={id:e.id,url:e.url,container:l,push:!1,fragment:e.fragment,timeout:e.timeout,scrollTo:!1},a?(o.trigger("pjax:start",[null,h]),t.state=e,e.title&&(document.title=e.title),w=n.Event("pjax:beforeReplace",{state:e,previousState:s}),o.trigger(w,[a,h]),o.html(a),o.trigger("pjax:end",[null,h])):t(h),o[0].offsetHeight):r(location.href)}u=!1}function et(t){var e=n.isFunction(t.url)?t.url():t.url,u=t.type?t.type.toUpperCase():"GET",r=n("<form>",{method:u==="GET"?"GET":"POST",action:e,style:"display:none"}),i,f;if(u!=="GET"&&u!=="POST"&&r.append(n("<input>",{type:"hidden",name:"_method",value:u.toLowerCase()})),i=t.data,typeof i=="string")n.each(i.split("&"),function(t,i){var u=i.split("=");r.append(n("<input>",{type:"hidden",name:u[0],value:u[1]}))});else if(n.isArray(i))n.each(i,function(t,i){r.append(n("<input>",{type:"hidden",name:i.name,value:i.value}))});else if(typeof i=="object")for(f in i)r.append(n("<input>",{type:"hidden",name:f,value:i[f]}));n(document.body).append(r);r.submit()}function p(t){t&&t.readyState<4&&(t.onreadystatechange=n.noop,t.abort())}function w(){return(new Date).getTime()}function b(t){var i=t.clone();return i.find("script").each(function(){this.src||n._data(this,"globalEval",!1)}),i.contents()}function k(n){return n.search=n.search.replace(/([?&])(_pjax|_)=[^&]*/g,"").replace(/^&/,""),n.href.replace(/\?($|#)/,"$1")}function f(n){var t=document.createElement("a");return t.href=n,t}function d(n){return n.href.replace(/#.*/,"")}function e(t,i){return t&&i?(i=n.extend({},i),i.container=t,i):n.isPlainObject(t)?t:{container:t}}function h(n,t){return n.filter(t).add(n.find(t))}function c(t){return n.parseHTML(t,document,!0)}function g(t,i,r){var u={},a=/<html/i.test(t),v=i.getResponseHeader("X-PJAX-URL"),s,o,l,e;return(u.url=v?k(f(v)):r.requestUrl,a?(o=n(c(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0])),l=t.match(/<head[^>]*>([\s\S.]*)<\/head>/i),s=l!=null?n(c(l[0])):o):s=o=n(c(t)),o.length===0)?u:(u.title=h(s,"title").last().text(),r.fragment?(e=o,r.fragment!=="body"&&(e=h(e,r.fragment).first()),e.length&&(u.contents=r.fragment==="body"?e:e.contents(),u.title||(u.title=e.attr("title")||e.data("title")))):a||(u.contents=o),u.contents&&(u.contents=u.contents.not(function(){return n(this).is("title")}),u.contents.find("title").remove(),u.scripts=h(u.contents,"script[src]").remove(),u.contents=u.contents.not(u.scripts)),u.title&&(u.title=n.trim(u.title)),u)}function ot(t){if(t){var i=n("script[src]");t.each(function(){var u=this.src,f=i.filter(function(){return this.src===u}),t,r;f.length||(t=document.createElement("script"),r=n(this).attr("type"),r&&(t.type=r),t.src=n(this).attr("src"),document.head.appendChild(t))})}}function st(n,r){i[n]=r;o.push(n);a(l,0);a(o,t.defaults.maxCacheLength)}function ht(n,r,u){var f,e;i[r]=u;n==="forward"?(f=o,e=l):(f=l,e=o);f.push(r);r=e.pop();r&&delete i[r];a(f,t.defaults.maxCacheLength)}function a(n,t){while(n.length>t)delete i[n.shift()]}function ct(){return n("meta").filter(function(){var t=n(this).attr("http-equiv");return t&&t.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function nt(){n.fn.pjax=it;n.pjax=t;n.pjax.enable=n.noop;n.pjax.disable=tt;n.pjax.click=v;n.pjax.submit=rt;n.pjax.reload=ut;n.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:ct};n(window).on("popstate.pjax",y)}function tt(){n.fn.pjax=function(){return this};n.pjax=et;n.pjax.enable=nt;n.pjax.disable=n.noop;n.pjax.click=n.noop;n.pjax.submit=n.noop;n.pjax.reload=function(){window.location.reload()};n(window).off("popstate.pjax",y)}var u=!0,ft=window.location.href,s=window.history.state;s&&s.container&&(t.state=s);"state"in window.history&&(u=!1);var i={},l=[],o=[];n.event.props&&n.inArray("state",n.event.props)<0?n.event.props.push("state"):"state"in n.Event.prototype||n.event.addProp("state");n.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);n.support.pjax?nt():tt()})(jQuery);