/** The Web UI Theme-v4.0.1 */;layui.define(["layer","laytpl","form","util","upload","dropdown","code"],function(e){function a(){this.v="4.0.1"}function s(a){return(a=a||{}).item=a.item||"d."+a.type,["{{# var length = 0; layui.each("+a.item+", function(i, data){ length++; }}",'<li layim-event="chat" data-type="'+a.type+'" data-index="{{= '+(a.index||"i")+' }}" class="layim-'+("history"===a.type?"{{=i}}":a.type+"{{=data.id}}")+' {{= data.status === "offline" ? "layim-list-gray" : "" }}"><img src="{{= data.avatar || layui.layim.cache().options.defaultAvatar }}"><span>{{= data.username||data.groupname||data.username||"\u4f5a\u540d" }}</span><p>{{= data.remark||data.sign||"" }}</p><span class="layim-msg-status">new</span></li>',"{{# }); if(length === 0){ }}",'<li class="layim-null">'+({friend:"\u8be5\u5206\u7ec4\u4e0b\u6682\u65e0\u597d\u53cb",group:"\u6682\u65e0\u7fa4\u7ec4",history:"\u6682\u65e0\u5386\u53f2\u4f1a\u8bdd"}[a.type]||"\u6682\u65e0\u6570\u636e")+"</li>","{{# } }}"].join("")}function d(a){var e=A("contentParser");return(e||Y)(a)}function u(a,e){var i=(a=f.extend({type:"get",dataType:"json",error:console.error},a)).success;return a.success=function(a){a=a.data||{};"function"==typeof e&&e(a),"function"==typeof i&&i.apply(null,arguments)},f.ajax(a)}function n(a,e){var i,t=a.value;a.focus(),document.selection?(i=document.selection.createRange(),document.selection.empty(),i.text=e):(i=[t.substring(0,a.selectionStart),e,t.substr(a.selectionEnd)],a.focus(),a.value=i.join(""))}var r,l,y,c,m,p,f=layui.$,h=layui.layer,g=layui.laytpl,o=layui.form,t=layui.util,v=layui.device(),b="layim",x="layui-show",C="layim-this",k="pending",w={callback:{},chat:[],message:{}},A=(a.prototype.config=function(a){var e={showFriend:!0,showGroup:!0},i=a.defaultAvatar||L("images/default.png");if(!0===(a=f.extend(!0,{contactsPanel:e,backgroundImage:!1,voice:"default.mp3",LOCAL_TABLE:"layim",LOCAL_MAX_CHATLOG:20,chatTimeout:1e4,defaultAvatar:i},a)).contactsPanel&&(a.contactsPanel=e),f.extend(!0,w,{options:a}),window.JSON&&window.JSON.parse)return D(w.options),this},a.prototype.on=function(a,e){return layui.onevent.call(this,b,a,e)},a.prototype.cache=function(){return w},a.prototype.setChatStatus=function(a){var e=I();if(e)return e.elem.find(".layim-chat-status").html(a),this},a.prototype.notice=function(a){return aa(a),this},a.prototype.setFriendStatus=function(a,e){f(".layim-friend"+a)["online"===e?"removeClass":"addClass"]("layim-list-gray")},a.prototype.extendChatTools=function(l){var a=w.options,e=a.chatTools||[];l="array"!==layui.type(l)?[l]:l,layui.each(l,function(i,t){layui.each(e,function(a,e){t.name&&t.name===e.name&&(f.extend(!0,e,t),l.splice(i,1))})}),a.chatTools=e.concat(l)},a.prototype.callback=function(a,e){var i=w.callback;if("function"!=typeof e)return i[a];i[a]=e,w.callback=i}),L=function(a){return layui.cache.layimResPath+a},F=['<div class="layui-layim-main">',"{{# var local = layui.layim.getLocalData(); ","var contactsPanel = d.options.contactsPanel;","}}",'<div class="layui-layim-info">','<div class="layui-layim-user">{{= d.user.username }}</div>','<div class="layui-layim-status">','{{# if(d.user.status === "online"){ }}','<span class="layui-icon layim-status-online" layim-event="status" lay-type="show">&#xe617;</span>','{{# } else if(d.user.status === "hide") { }}','<span class="layui-icon layim-status-hide" layim-event="status" lay-type="show">&#xe60f;</span>',"{{# } }}",'<ul class="layui-anim layim-border layim-menu-box">','<li {{=d.user.status === "online" ? "class=layim-this" : ""}} layim-event="status" lay-type="online"><i class="layui-icon">&#xe605;</i><cite class="layui-icon layim-status-online">&#xe617;</cite>\u5728\u7ebf</li>','<li {{=d.user.status === "hide" ? "class=layim-this" : ""}} layim-event="status" lay-type="hide"><i class="layui-icon">&#xe605;</i><cite class="layui-icon layim-status-hide">&#xe60f;</cite>\u9690\u8eab</li>',"</ul>","</div>",'<input class="layui-layim-remark" placeholder="\u7f16\u8f91\u7b7e\u540d" value="{{- d.user.remark||d.user.sign||"" }}">',"</div>",'<ul class="layui-unselect layim-border layui-layim-tab{{# if(!contactsPanel.showFriend || !contactsPanel.showGroup){ }}'," layim-tab-two",'{{# } }}">','<li class="layui-icon',"{{# if(!contactsPanel.showFriend){ }}"," layim-hide","{{# } else { }}"," layim-this","{{# } }}",'" title="\u8054\u7cfb\u4eba" layim-event="tab" lay-type="friend">&#xe612;</li>','<li class="layui-icon',"{{# if(!contactsPanel.showGroup){ }}"," layim-hide","{{# } else if(!contactsPanel.showFriend) { }}"," layim-this","{{# } }}",'" title="\u7fa4\u7ec4" layim-event="tab" lay-type="group">&#xe613;</li>','<li class="layui-icon" title="\u5386\u53f2\u4f1a\u8bdd" layim-event="tab" lay-type="history">&#xe611;</li>',"</ul>",'<ul class="layui-unselect layim-tab-content layim-scrollbar {{# if(contactsPanel.showFriend){ }}layui-show{{# } }} layim-list-friend">','{{# layui.each(d.friend, function(index, item){ var spread = local["spread"+index]; }}',"<li>",'<h5 layim-event="spread" lay-type="{{= spread }}"><i class="layui-icon">{{# if(spread === "true"){ }}&#xe61a;{{# } else {  }}&#xe602;{{# } }}</i><span>{{= item.groupname||"\u672a\u547d\u540d\u5206\u7ec4"+index }}</span><em>(<cite class="layim-count"> {{= (item.list||[]).length }}</cite>)</em></h5>','<ul class="layui-layim-list {{# if(spread === "true"){ }}'," layui-show",'{{# } }}">',s({type:"friend",item:"item.list",index:"index"}),"</ul>","</li>","{{# }); if(d.friend.length === 0){ }}",'<li><ul class="layui-layim-list layui-show"><li class="layim-null">\u6682\u65e0\u8054\u7cfb\u4eba</li></ul>',"{{# } }}","</ul>",'<ul class="layui-unselect layim-tab-content layim-scrollbar {{# if(!contactsPanel.showFriend && contactsPanel.showGroup){ }}layui-show{{# } }}">',"<li>",'<ul class="layui-layim-list layui-show layim-list-group">',s({type:"group"}),"</ul>","</li>","</ul>",'<ul class="layui-unselect layim-tab-content layim-scrollbar {{# if(!contactsPanel.showFriend && !contactsPanel.showGroup){ }}layui-show{{# } }}">',"<li>",'<ul class="layui-layim-list layui-show layim-list-history">',s({type:"history"}),"</ul>","</li>","</ul>",'<ul class="layui-unselect layim-tab-content">',"<li>",'<ul class="layui-layim-list layui-show" id="layui-layim-search"></ul>',"</li>","</ul>",'<ul class="layui-unselect layui-layim-tool layim-border">','<li class="layui-icon layui-icon-search layim-tool-search" layim-event="search" title="\u641c\u7d22"></li>',"{{# if(d.options.pageurl && d.options.pageurl.msgbox){ }}",'<li class="layui-icon layui-icon-speaker layim-tool-msgbox" layim-event="msgbox" title="\u6d88\u606f\u76d2\u5b50"><span class="layui-anim"></span></li>',"{{# } }}","{{# if(d.options.pageurl && d.options.pageurl.find){ }}",'<li class="layui-icon layim-tool-find" layim-event="find" title="\u67e5\u627e">&#xe608;</li>',"{{# } }}",'<li class="layui-icon layui-icon-set layui-font-18" layim-event="set" title="\u8bbe\u7f6e"></li>',"</ul>",'<div class="layui-layim-search"><input><label class="layui-icon" layim-event="closeSearch">&#x1007;</label></div>',"</div>"].join(""),q=['<div class="layui-form" lay-filter="layim-set">','<div class="layui-form-item">','<label class="layui-form-label">\u4e3b\u9898\u6a21\u5f0f</label>','<div class="layui-form-block">','<input type="checkbox" name="theme" lay-filter="layim-theme-mode" lay-skin="switch">',"<div lay-checkbox>",'<i class="layui-icon layui-icon-moon"></i> |','<i class="layui-icon layui-icon-light"></i>',"</div>","</div>","</div>",'<div class="layui-form-item">','<label class="layui-form-label">\u80cc\u666f\u5e95\u56fe</label>','<div class="layui-form-block layui-clear">','<ul class="layui-layim-skin">',"{{# layui.each(d.backgroundImages, function(index, item){ }}",'<li><img layim-event="setBackgroundImage" src="{{= item }}"></li>',"{{# }); }}",'<li layim-event="setBackgroundImage"><cite>\u65e0\u56fe</cite></li>',"</ul>","</div>","</div>","</div>"].join(""),G=['<div class="layim-chat layim-chat-{{=d.data.type}}{{=d.first ? " layui-show" : ""}}">','<div class="layui-unselect layim-chat-title">','<div class="layim-chat-other">','<img class="layim-{{= d.data.type }}{{= d.data.id }}" src="{{= d.data.avatar || layui.layim.cache().options.defaultAvatar }}"><span class="layim-chat-username" layim-event="{{= d.data.type==="group" ? "groupMembers" : "" }}">{{= d.data.username||"\u4f5a\u540d" }} {{- d.data.temporary ? "<cite>\u4e34\u65f6\u4f1a\u8bdd</cite>" : "" }} {{# if(d.data.type==="group"){ }} <em class="layim-chat-members"></em><i class="layui-icon">&#xe61a;</i> {{# } }}</span>','<span class="layim-chat-status"></span>',"</div>","</div>",'<div class="layim-chat-main layim-scrollbar"><ul></ul></div>','<div class="layim-chat-footer layim-border">','<div class="layui-unselect layim-chat-tool">',"{{# layui.each(d.options.chatTools, function(i, item){ }}","{{# if(item.hide) return; }}","{{# var onClickType = typeof item.onClick; }}",'{{# var eventName = onClickType === "function" ? "extendChatTool" : (onClickType === "string" ? item.onClick : item.name); }}','<span class="layui-icon {{=item.icon||\'\'}} layim-tool-{{=item.name}}" title="{{=item.title||\'\'}}" layim-event="{{=eventName}}" data-chat-toolname="{{=item.name}}">','{{# if (item.onClick === "file") { }}','<input type="file" name="file">',"{{# } }}","</span>","{{# }); }}","</div>",'<div class="layim-chat-textarea"><textarea class="layim-scrollbar"></textarea></div>','<div class="layim-chat-bottom">','<div class="layim-chat-send">','<span class="layim-send-close" layim-event="closeThisChat">\u5173\u95ed</span>','<span class="layim-send-btn" layim-event="send">\u53d1\u9001</span>','<span class="layim-send-set layim-border" layim-event="setSend" lay-type="show"><i class="layui-icon layui-icon-down"></i></span>','<ul class="layui-anim layim-border layim-menu-box">','<li {{=d.local.sendHotKey !== "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend" lay-type="Enter"><i class="layui-icon">&#xe605;</i>\u6309 Enter \u952e\u53d1\u9001\u6d88\u606f</li>','<li {{=d.local.sendHotKey === "Ctrl+Enter" ? "class=layim-this" : ""}} layim-event="setSend"  lay-type="Ctrl+Enter"><i class="layui-icon">&#xe605;</i>\u6309 Ctrl+Enter \u952e\u53d1\u9001\u6d88\u606f</li>',"</ul>","</div>","</div>","</div>","</div>"].join(""),N=['<div class="layim-add-box">',"{{# var cache = layui.layim.cache(); var user = cache.user || {}; }}",'<div class="layim-add-img"><img class="layui-circle" src="{{= d.data.avatar || cache.options.defaultAvatar }}"><p>{{= d.data.username||"" }}</p></div>','<div class="layim-add-remark">','{{# if(d.type === "addFriend"){ }}',"<p>\u9009\u62e9\u5206\u7ec4\uff1a</p>","{{# } }}",'{{# if(d.data.type === "friend"){ }}','<select class="layui-select" id="LAY_layimGroup">',"{{# layui.each(d.data.group, function(index, item){ }}",'<option value="{{= item.id }}">{{= item.groupname }}</option>',"{{# }); }}","</select>","{{# } }}",'{{# if(d.data.type === "group"){ }}',"<p>\u586b\u5199\u9a8c\u8bc1\u4fe1\u606f\uff1a</p>","{{# } }}",'{{# if(d.type !== "addFriend"){ }}','<textarea id="LAY_layimRemark" placeholder="\u9a8c\u8bc1\u4fe1\u606f" class="layui-textarea">\u6211\u662f{{= user.username || "" }}</textarea>',"{{# } }}","</div>","</div>"].join(""),T=['<li {{= d.user ? "class=layim-chat-role-user" : "" }} {{# if(d.mid){ }}data-mid="{{=d.mid}}"{{# } }} {{= d.status || "" }}>','<div class="layim-chat-userinfo">','<img src="{{= d.avatar || layui.layim.cache().options.defaultAvatar }}"><cite>',"{{# if(d.user){ }}",'<i>{{= layui.util.toDateString(d.timestamp) }}</i>{{= d.username||"\u4f5a\u540d" }}',"{{# } else { }}",'{{= d.username||"\u4f5a\u540d" }}<i>{{= layui.util.toDateString(d.timestamp) }}</i>',"{{# } }}","</cite>","</div>",'{{# var content = d.content || "&nbsp"; }}','<div class="layim-chat-text layui-text">',"{{- content }}","</div>","</li>"].join(""),K='<li class="layim-{{= d.data.type }}{{= d.data.id }} layim-chatlist-{{= d.data.type }}{{= d.data.id }} layim-this" layim-event="tabChat"><img src="{{= d.data.avatar || layui.layim.cache().options.defaultAvatar }}"><span>{{= d.data.username||"\u4f5a\u540d" }}</span><i class="layui-icon layui-icon-close-fill" layim-event="closeChat"></i></li>',Y=w.callback.contentParser=function(a){return a=(a||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/.+\n?/g,function(a){var e=a.trim().replace(/\s/g,"");return/^\-(\-+)\-$/.test(e)?"<hr>":/^\>.*$/.test(e)?a.replace(/^.*\>(.*)\n?$/,"<blockquote>$1</blockquote>"):a}).replace(/!\[(.*?)\]\((.*?)\)/g,function(a,e,i){return'<img src="'+i+'" alt="'+e+'">'}).replace(/!file\[(.*?)\]\((.*?)\)/g,function(a,e,i){return['<a class="layui-layim-file" href="'+i+'" download target="_blank">','<i class="layui-icon layui-icon-layim-download"></i>',"<cite>"+e+"</cite>","</a>"].join("")}).replace(/!audio\((.*?)\)/g,function(a,e){return['<div class="layui-unselect layui-layim-audio" layim-event="playAudio" data-src="'+e+'">','<i class="layui-icon layui-icon-play"></i>',"<p>\u8bed\u97f3\u6d88\u606f</p>","</div>"].join("")}).replace(/!video\((.*?)\)/g,function(a,e){return['<div class="layui-unselect layui-layim-video" layim-event="playVideo" data-src="'+e+'">','<i class="layui-icon layui-icon-play"></i>',"</div>"].join("")}).replace(/\[(.*?)\]\((.+?)\)/g,function(a,e,i){return'<a href="'+i+'" target="_blank">'+((e=e.replace(/^\s+|\s+$/g,""))||i)+"</a>"}).replace(/\*\*(?!\s)([^\*\r\n]+?)(?<!\s)\*\*/g,function(a,e){return"<strong>"+e+"</strong>"}).replace(/\*(?!\s)([^\*\r\n]+?)(?<!\s)\*/g,function(a,e){return"<em>"+e+"</em>"}).replace(/(?<!#)(#{1,6}) +(.+)\n?/g,function(a,e,i){e="h"+e.length;return"<"+e+">"+i+"</"+e+">"}).replace(/\`{3}(\w*)\n([\s\S]*?)\`{3}/g,function(a,e,i){return'<pre><code class="'+(e=e?"language-"+e:"")+'">'+i.replace(/\n/g,"\\KN")+"</code></pre>"}).replace(/\n/g,"<br>").replace(/\\KN/g,"\n")},D=function(t){function a(a){var e=a.user||{},i=_(e.id);o(e,{friend:a.friend||[],group:a.group||[],history:i.history||{}}),R(g(F).render(w)),(i.close||n.minStatus)&&X(),l(a)}function l(a){var e=a.user||{},e=_(e.id),i=t.theme||e.theme;$(i),e.theme=i,layui.data(t.LOCAL_TABLE,{key:w.user.id,value:e}),layui.event.call(a,b,"ready",w)}var e=t.init||{},i=e.user||{},n=t.contactsPanel,o=function a(e,i){return f.extend(!0,w,{options:t,user:e},i),a}(i);if(i=[{name:"face",title:"\u63d2\u5165\u8868\u60c5",icon:"layui-icon-face-smile-fine"}],(t.pageurl||{}).chatlog&&i.push({name:"chatlog",title:"\u804a\u5929\u8bb0\u5f55",icon:"layui-icon-log layim-tool-log"}),t.chatTools=t.chatTools||i,!t.contactsPanel)return l(e);e.url?u(e,a):a(e)},R=function(a){var i=w.options,t=i.contactsPanel;return h.open({type:1,area:["260px","518px"],skin:"layui-layim layui-layim-layer",title:"&#8203;",offset:"rb",id:"layui-layim",shade:!1,anim:2,resize:!1,content:a,success:function(a){Z(r=a),l&&h.close(l.attr("times"));var e=[],a=a.find(".layim-list-history");a.find("li").each(function(){e.push(f(this).prop("outerHTML"))}),0<e.length&&(e.reverse(),a.html(e.join(""))),V(),z.sign(),"function"==typeof t.done&&t.done.apply(null,arguments)},cancel:function(a){X();var e=_();return e.close=!0,layui.data(i.LOCAL_TABLE,{key:w.user.id,value:e}),!1}})},_=a.prototype.getLocalData=function(a){var e=w.user||{};return a=null==a?e.id:a,layui.data(w.options.LOCAL_TABLE)[a]||{}},$=a.prototype.theme=function(a){var e="LAYIM-THEME",i=".layui-layim";if("light"===a)return f("#LAY-STYLE-"+e).remove();"dark"===a&&lay.style({id:e,target:f(i)[0]?i:"body",text:g([".layim-scrollbar{scrollbar-color: rgba(255,255,255,.16) rgba(0,0,0,0);}","body .layui-layim-layer{background-color: {{=d.bgcolor}}; color: {{=d.textColor1}}; }","body .layui-layim-layer a{color: {{=d.textColor2}};}","body .layui-layim-layer .layui-layer-title, .layim-tab-content, .layui-layim-tool, body .layui-layim-chat .layui-layer-title, .layim-chat{background: {{=d.bgcolor1}}; color: {{=d.textColor1}}; }",".layim-chat-list{background: {{=d.bgcolor2}}; }",".layui-layim-layer .layui-layer-setwin span, .layui-layim-info .layui-layim-user, .layui-layim-remark, .layui-layim-tab li, .layim-chat-other span{color:{{=d.textColor1}} ;}",".layui-layim-layer .layui-layer-setwin .layui-layer-min:before, .layui-layim-layer .layui-layer-setwin .layui-layer-max:before, .layui-layim-layer .layui-layer-setwin .layui-layer-max:after{border-color: rgba(255,255,255,.3);}",".layim-border{border-color: {{=d.borderColor1}};}",".layim-menu-box{background-color: {{=d.bgcolor2_1}}; border-color: {{=d.borderColor1}};}",".layim-menu-box li:hover{background-color: {{=d.bgcolor3_1}}; }",".layui-layim-remark:hover, body .layui-layim-layer .layui-layer-title{border-color: {{=d.borderColor1}};}",".layui-layim-remark:focus{border-color: {{=d.borderColor3}}; background: none;}",".layui-layim-list li:hover{background-color: {{=d.bgcolor2}}; }",".layui-layim-tool li:active{background-color: {{d.bgcolor3}}; }",".layim-chat-text, .layim-chat-system span, .layim-chat-send span, .layui-layim-members ul, .layui-layim-face ul, .layui-layim-skin li{background-color: {{d.bgcolor2}}; color:{{=d.textColor1}}; }",".layim-chat-text{color:{{=d.textColor2}} ;}",".layim-chat-text:after{border-top-color: {{d.bgcolor2}};}",".layim-chat-role-user .layim-chat-text{color: #000 ;}",".layim-chat-tool span:hover{color: {{=d.textColor2}}; }",".layim-chat-tool span:active{color: {{=d.textColor3}}; }",".layim-chat-textarea textarea{color:{{=d.textColor2}};}",".layim-loading > .layui-icon{color: {{=d.textColor1}}; }",".layim-chat-text code:not(.layui-code-view, .layui-code-wrap), .layim-chat-send span:hover{background-color: {{d.bgcolor3}}; }",".layim-chat-list li.layim-this, .layim-chat-list li:hover{background-color: rgba(255,255,255,.1); }",".layim-chat-list li .layui-icon{color: {{=d.textColor1}}; }",".layui-layim-layer .layui-form .layui-form-onswitch{background: none; border-color: {{=d.borderColor3}}; }","body .layui-layim-min{border: none;}"].join("")).render({bgcolor:"rgba(50,50,50,1);",bgcolor1:"rgba(50,50,50,.9);",bgcolor2:"rgba(65,65,65,.9);",bgcolor2_1:"rgba(65,65,65,1);",bgcolor3:"rgba(77,77,77,.9);",bgcolor3_1:"rgba(77,77,77,1);",textColor1:"rgba(255,255,255,.7)",textColor2:"rgba(255,255,255,.9)",textColor3:"rgba(255,255,255,1)",borderColor1:"rgba(255,255,255,.1)",borderColor3:"rgba(255,255,255,.3)"})})},V=function(){r.on("contextmenu",function(a){return a.cancelBubble=!0,a.returnValue=!1});function t(){h.closeAll("tips")}r.find(".layim-list-history").on("contextmenu","li",function(a){var e=f(this),i='<ul data-id="'+e[0].id+'" data-index="'+e.data("index")+'"><li layim-event="menuHistory" data-type="one">\u79fb\u9664\u8be5\u4f1a\u8bdd</li><li layim-event="menuHistory" data-type="all">\u6e05\u7a7a\u5168\u90e8\u4f1a\u8bdd\u5217\u8868</li></ul>';e.hasClass("layim-null")||(h.tips(i,this,{tips:1,time:0,anim:5,fixed:!0,skin:"layui-layim-contextmenu",success:function(a){a.off("mousedown",layui.stope).on("mousedown",layui.stope)}}),f(document).off("mousedown",t).on("mousedown",t),f(window).off("resize",t).on("resize",t))})},X=function(a){var i=w.options,e=w.user||{},t=i.contactsPanel;return l&&h.close(l.attr("times")),r&&r.hide(),h.open({type:1,title:!1,id:"layui-layim-close",skin:"layui-layim-min layui-layim-close layui-layim-layer",shade:!1,closeBtn:!1,anim:2,offset:"rb",resize:!1,content:['<img src="'+(e.avatar||i.defaultAvatar)+'">',(a=a||e.username)?"<span>"+a+"</span>":""].join(""),move:"#layui-layim-close img",success:function(a,e){(l=a).on("click",function(){h.close(e),r.show();var a=_();delete a.close,layui.data(i.LOCAL_TABLE,{key:w.user.id,value:a})}),"function"==typeof t.done&&t.done.apply(null,arguments)}})},E=a.prototype.chat=function(t){t=t||{};function l(a){a.data("receiver",t)}var a,e,i,n="layim-chat-box",o=f("#layui-layim-chat"),s={data:t,options:w.options,local:_()};if(!t.id)return console.error("\u672a\u4f20\u5165\u5fc5\u8981\u53c2\u6570\uff1aid");if(t.new&&(o.closest(".layui-layim-chat").remove(),delete o[0]),o[0])return e=(a=y.find(".layim-chat-list")).find(".layim-chatlist-"+t.type+t.id),i=y.find(".layui-layer-max").hasClass("layui-layer-maxmin"),o=o.children("."+n),"none"===y.css("display")&&y.show(),c&&h.close(c.attr("times")),1!==a.find("li").length||e[0]||(i||y.addClass("layui-layim-chat-more").css("width",800),a.css({height:y.height()}).show(),o.css("margin-left","200px"),m&&m.offset()),e[0]||(a.append(g(K).render(s)),o.append(g(G).render(s)),l(o.children(".layim-chat:last")),J(t),O()),P(a.find(".layim-chatlist-"+t.type+t.id)),e[0]||la(),Q(t),na(),p;s.first=!0;var r=p=h.open(f.extend({type:1,area:"600px",skin:"layui-layim-chat layui-layim-layer",id:"layui-layim-chat",title:"&#8203;",shade:!1,maxmin:!0,offset:"auto",anim:5,content:g('<ul class="layui-unselect layim-scrollbar layim-chat-list">'+K+'</ul><div class="'+n+'">'+G+"</div>").render(s),success:function(a,e,i){m=i,(y=a).css({"min-width":"500px","min-height":"450px"}),l(a.find("."+n).children(".layim-chat:last")),J(t),na(),Z(a),Q(t),la(),U(),a.on("dblclick",".layim-chat-text img",function(){var a=this.src;h.close(E.photosIndex),h.photos({photos:{data:[{alt:"\u5927\u56fe\u6a21\u5f0f",src:a}]},anim:5,resize:!1,success:function(a,e){E.photosIndex=e}})});i=I();layui.event.call(i.elem,b,"chatChange",i),layui.event.call(i.elem,b,"chatInit",i),"function"==typeof t.success&&t.success.apply(t,arguments)},full:function(a){h.style(r,{width:"100%",height:"100%"},!0),O()},resizing:O,restore:O,min:function(){return H(),!1},end:function(){h.closeAll("tips"),y=null}},t.layer));return r},J=function(a){f(".layim-"+a.type+a.id).each(function(){f(this).hasClass("layim-list-gray")&&layui.layim.setFriendStatus(a.id,"offline")})},O=function(){var a=y.find(".layim-chat-list"),e=y.find(".layim-chat-main"),i=y.height();y.find(".layui-layer-title").outerHeight(),y.find(".layim-chat-footer").outerHeight();a.css({height:i}),e.css({height:i-52-150})},H=a.prototype.setChatMin=function(i){var a=i||I().data;layui.layim.cache().options;y&&!i&&y.hide(),h.close(H.index),H.index=h.open(f.extend({type:1,title:!1,skin:"layui-layim-min layui-layim-layer",shade:!1,closeBtn:!1,anim:2,offset:"b",move:"#layui-layim-min",resize:!1,content:'<img id="layui-layim-min" src="'+(a.avatar||w.options.defaultAvatar)+'"><span>'+a.username+"</span>",success:function(a,e){i||(c=a),a.find(".layui-layer-content span").on("click",function(){h.close(e),i?layui.each(w.chat,function(a,e){E(e)}):y.show(),i&&(w.chat=[],M())}),a.find(".layui-layer-content img").on("click",function(a){layui.stope(a)})}},i&&i.layer))},i=a.prototype.openRequestContactsPanel=function(t,a){t=t||{};var e="addFriend"===a?"\u540c\u610f\u6dfb\u52a0\u597d\u53cb":{friend:"\u7533\u8bf7\u597d\u53cb",group:"\u7533\u8bf7\u7fa4\u804a"}[t.type]||"";return h.close(i.index),i.index=h.open({type:1,area:"430px",title:e,shade:!1,resize:!1,btn:a?["\u786e\u8ba4","\u53d6\u6d88"]:["\u53d1\u9001\u7533\u8bf7","\u5173\u95ed"],content:g(N).render({data:{username:t.username||t.groupname,avatar:t.avatar||w.options.defaultAvatar,group:t.group||parent.layui.layim.cache().friend||[],type:t.type},type:a}),yes:function(a,e){var i=e.find("#LAY_layimGroup"),e=e.find("#LAY_layimRemark"),i={gid:i.val(),note:e.val(),index:a};"function"==typeof t.onConfirm&&t.onConfirm(i)},btn1:function(a,e){"function"==typeof t.onCancel&&t.onCancel({index:a})}})},P=(a.prototype.openAddFriendPanel=function(a){return i(a,"addFriend"),this},function(a,e){var i=-1===(a=a||f(".layim-chat-list ."+C)).index()?0:a.index(),t=".layim-chat",l=y.find(t).eq(i),n=y.find(".layui-layer-max").hasClass("layui-layer-maxmin");if(e)return a.hasClass(C)&&P(0===i?a.next():a.prev()),1===(e=y.find(t).length)?h.close(p):(a.remove(),l.remove(),2===e&&(y.find(".layim-chat-list").hide(),n||y.removeClass("layui-layim-chat-more").css("width","600px"),y.find(".layim-chat-box").css("margin-left",0),m)&&m.offset(),!1);a.addClass(C).siblings().removeClass(C),l.addClass(x).siblings(t).removeClass(x),l.find(".layim-loading")[0]||l.find("textarea").focus();i=I();layui.event.call(i.elem,b,"chatChange",i),U()}),U=function(){var a=I();w.message[a.data.type+a.data.id]&&delete w.message[a.data.type+a.data.id]},I=a.prototype.currentChat=function(a){var e,i;if(y)return a=void 0===a?f(".layim-chat-list ."+C).index():a,e=(a=y.find(".layim-chat").eq(a)).find(".layim-chat-textarea>textarea"),i=a.data("receiver"),{elem:a,data:i,textarea:e}},Z=function(a){var e=w.options,i=_().backgroundImage;a.css({"background-image":i?"url("+i+")":e.backgroundImage?"url("+L("images/background/"+e.backgroundImage)+")":"none"})},Q=function(a){var e,i=w.options,t=_(),l={},n=t.history||{},o=n[a.type+a.id];r&&(e=r.find(".layim-list-history"),a.historyTime=(new Date).getTime(),n[a.type+a.id]=a,t.history=n,layui.data(i.LOCAL_TABLE,{key:w.user.id,value:t}),o||(l[a.type+a.id]=a,n=g(s({type:"history",item:"d.data"})).render({data:l}),e.prepend(n),e.find(".layim-null").remove()))},S=a.prototype.sendMessage=function(a){var e=w.options,i={username:w.user?w.user.username:"\u8bbf\u5ba2",avatar:w.user?w.user.avatar:e.defaultAvatar,id:w.user?w.user.id:null,user:!0},t=I(),l=t.data,n="ai"===l.type,o=t.elem.find(".layim-chat-main > ul"),s=t.textarea;i.content=a=String(a||s.val()),""!==a.replace(/\s/g,"")&&(o.append(g(T).render(f.extend({},i,{content:d(a)}))),j(o.children("li:last-child")),n&&W(),o={user:i,receiver:l},i={username:i.username,avatar:i.avatar||e.defaultAvatar,id:l.id,type:l.type,content:a,timestamp:(new Date).getTime(),user:!0},ta(i),layui.event.call(t.elem,b,"sendMessage",o)),M(),s.val(""),n?s.blur():s.focus()},W=function(a,e){function i(){return o.children("li["+k+"]").children(".layim-chat-text")}var t=w.options,a=I(a),l=a.data,n=a.elem,o=a.elem.find(".layim-chat-main > ul"),a=n.find(".layim-loading");clearTimeout(o.data("timer")),"function"==typeof e?e(i(),a):(n.append('<div class="layim-loading"></div>'),o.append(g(T).render(f.extend({},l,{content:'<i class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop"></i> \u6b63\u5728\u601d\u8003\u4e2d\u2026',status:k}))),o.data("timer",setTimeout(function(){i().html("<strong>Error:</strong> Message timeout"),n.find(".layim-loading").remove()},t.chatTimeout)))},aa=function(a){a=a||{},window.Notification&&("granted"===Notification.permission?new Notification(a.title||"",{body:a.content||"",icon:a.avatar||w.options.defaultAvatar}):Notification.requestPermission())},ea=a.prototype.getMessage=function(i){i=f.extend({finished:!0,saveLocalChatlog:!0},i);var t,l,n,o,a=w.options,e=w.user,s=(_(),"ai"===i.type),r=f(".layim-chatlist-"+i.type+i.id),c={},u=r.index();if((i.timestamp=i.timestamp||(new Date).getTime(),"group"===i.type?i.uid===e.id&&(i.user=!0):i.id===e.id&&(i.user=!0),i.finished)&&(i.saveLocalChatlog&&ta(i),a.voice&&!s&&(f("body").trigger("click"),ea.init?v.ie&&v.ie<9||((e=document.createElement("audio")).src=L("voice/"+w.options.voice),e.play()):ea.init=!0),(!y&&i.content||-1===u)&&(w.message[i.type+i.id]?w.message[i.type+i.id].push(i):(w.message[i.type+i.id]=[i],"friend"===i.type?(layui.each(w.friend,function(a,e){if(layui.each(e.list,function(a,e){if(e.id==i.id)return e.type="friend",e.username=e.username,w.chat.push(e),t=!0}),t)return!0}),t||(i.temporary=!0,w.chat.push(i))):"group"===i.type?(layui.each(w.group,function(a,e){if(e.id==i.id)return e.type="group",e.username=e.groupname,w.chat.push(e),l=!0}),l||(i.username=i.groupname,w.chat.push(i))):(i.username=i.username||i.groupname,w.chat.push(i))),"group"===i.type&&layui.each(w.group,function(a,e){if(e.id==i.id)return c.avatar=e.avatar||w.options.defaultAvatar,!0}),!i.system)))return a.notice&&!s&&aa({title:"\u6765\u81ea "+i.username+" \u7684\u6d88\u606f",content:i.content,avatar:c.avatar||i.avatar||a.defaultAvatar}),H({username:"\u6536\u5230\u65b0\u6d88\u606f",avatar:c.avatar||i.avatar||a.defaultAvatar,anim:6});y&&(e=I(),i.finished&&e.data.type+e.data.id!==i.type+i.id&&(r.addClass("layui-anim layer-anim-06"),setTimeout(function(){r.removeClass("layui-anim layer-anim-06")},300)),n=y.find(".layim-chat").eq(u).find(".layim-chat-main > ul"),s=e.textarea,a=i.content,i.system?-1!==u&&n.append('<li class="layim-chat-system"><span'+(i.saveChatlog?' class="layui-font-green"':"")+">"+a+"</span></li>"):(o=d(a),W(u,function(a,e){a[0]?a.html(o):n.append(g(T).render(f.extend({},i,{content:o}))),i.finished&&(a.closest("li["+k+"]").removeAttr(k),e.remove())})),M(),s.focus(),j(n.children("li:last-child")))},j=function(a){var e=w.options,i=_();layui.code({elem:a.find("pre>code"),theme:e.theme||i.theme||""})},ia="layui-anim-loop layer-anim-05",ta=(a.prototype.setMsgboxCount=function(a){r.find(".layim-tool-msgbox").find("span").addClass(ia).html(a)},function(i){var t,a=w.options,e=_(),l=(I()||{}).data||{};"enableLocalChatlog"in l&&!l.enableLocalChatlog||(e.chatlog=e.chatlog||{},(l=e.chatlog[i.type+i.id])?(layui.each(l,function(a,e){e.timestamp===i.timestamp&&e.type===i.type&&e.id===i.id&&e.content===i.content&&(t=!0)}),t||i.fromid==w.user.id||l.push(i),l.length>a.LOCAL_MAX_CHATLOG&&l.shift()):e.chatlog[i.type+i.id]=[i],layui.data(a.LOCAL_TABLE,{key:w.user.id,value:e}))}),la=function(t){w.options;function a(a){var e=l.elem.find(".layim-chat-main ul"),i=[];"array"===layui.type(a)&&(layui.each(a,function(a,e){e.system?i.push('<li class="layim-chat-system"><span class="layui-font-green">'+e.content+"</span></li>"):i.push(g(T).render(f.extend({},e,{content:d(e.content)})))}),e.append(i.join("")),M(),j(l.elem),"function"==typeof t)&&t()}var e=_(),l=I(),i=l.data,e=(e.chatlog||{})[i.type+i.id],n=A("chatlog");if("function"==typeof n)return(n=n({user:w.user,receiver:i}))&&"function"==typeof n.then?n.then(a,console.error):a(n);a(e)},M=(a.prototype.addContacts=function(i){var t,a,e,l={},n=r.find(".layim-list-"+i.type);if(w[i.type])if("friend"===i.type)layui.each(w.friend,function(a,e){if(i.gid==e.id)return layui.each(w.friend[a].list,function(a,e){if(e.id==i.id)return t=!0}),t?h.msg("\u597d\u53cb ["+(i.username||"")+"] \u5df2\u7ecf\u5b58\u5728\u5217\u8868\u4e2d",{anim:6}):(w.friend[a].list=w.friend[a].list||[],(l[w.friend[a].list.length]=i).groupIndex=a,w.friend[a].list.push(i),!0)});else if("group"===i.type){if(layui.each(w.group,function(a,e){if(e.id==i.id)return t=!0}),t)return h.msg("\u60a8\u5df2\u662f ["+(i.groupname||"")+"] \u7684\u7fa4\u6210\u5458",{anim:6});l[w.group.length]=i,w.group.push(i)}t||(a=g(s({type:i.type,item:"d.data",index:"friend"===i.type?"data.groupIndex":null})).render({data:l}),"friend"===i.type?((e=n.find(">li").eq(i.groupIndex)).find(".layui-layim-list").append(a),e.find(".layim-count").html(w.friend[i.groupIndex].list.length),e.find(".layim-null")[0]&&e.find(".layim-null").remove()):"group"===i.type&&(n.append(a),n.find(".layim-null")[0])&&n.find(".layim-null").remove())},a.prototype.removeContacts=function(t){var l=r.find(".layim-list-"+t.type);w[t.type]&&("friend"===t.type?layui.each(w.friend,function(i,a){layui.each(a.list,function(a,e){if(t.id==e.id)return(e=l.find(">li").eq(i)).find(".layui-layim-list>li"),e.find(".layui-layim-list>li").eq(a).remove(),w.friend[i].list.splice(a,1),e.find(".layim-count").html(w.friend[i].list.length),0===w.friend[i].list.length&&e.find(".layui-layim-list").html('<li class="layim-null">\u8be5\u5206\u7ec4\u4e0b\u5df2\u65e0\u597d\u53cb\u4e86</li>'),!0})}):"group"===t.type&&layui.each(w.group,function(a,e){if(t.id==e.id)return l.find(">li").eq(a).remove(),w.group.splice(a,1),0===w.group.length&&l.html('<li class="layim-null">\u6682\u65e0\u7fa4\u7ec4</li>'),!0}))},function(){var a,e=w.options,i=I().elem.find(".layim-chat-main"),t=i.children("ul"),l=t.children("li"),n=l.length,e=e.LOCAL_MAX_CHATLOG;e<=n&&(a=l.eq(0),t.prev().hasClass("layim-chat-system")||t.before('<div class="layim-chat-system"><span layim-event="chatlog">\u2026</span></div>'),e<n)&&a.remove(),i.scrollTop(i[0].scrollHeight+1e3),l.last().find("img").on("load",function(){i.scrollTop(i[0].scrollHeight+1e3)})}),na=function(){var t=I().textarea;t.focus(),t.off("keydown").on("keydown",function(a){var e=_(),i=a.keyCode;if("Ctrl+Enter"===e.sendHotKey)a.ctrlKey&&13===i&&S();else if(13===i){if(a.ctrlKey)return t.val(t.val()+"\n");a.shiftKey||(a.preventDefault(),S())}})},oa={"\u543c\u543c":"^O^","\u60ca\u8bb6":"w(\uff9f\u0414\uff9f)w","\u4e0d\u5c51":" (\uffe3_,\uffe3 )","\u597d\u8036":"\u30fd(\u273f\uff9f\u25bd\uff9f)\u30ce","\u4eb2":"o(*\uffe33\uffe3)o","\u68d2":"(\u0e51\u2022\u0300\u3142\u2022\u0301)\u0648\u2727","\u6da8":"  (\uffe3\ufe36\uffe3)\u2197","\u5f97\u610f":"<(\uffe3\ufe36\uffe3)>","\u6316\u9f3b\u5b54":" (*\uffe3r\u01d2\uffe3)","\u60ca":"\u2299\u02cd\u2299","\u98de":"\ufe3f(\uffe3\ufe36\uffe3)\ufe3f","\u54fc\u54fc":"o(\uffe3\u30d8\uffe3o\uff03)","\u597d\u6ef4":" (u\u203f\u0e3au\u273f\u0e3a)","\u554a\u554a":"\uff2f(\u2267\u53e3\u2266)\uff2f","\u5566\u5566":"\u266a(^\u2207^*)","\u60ca\u559c":"\u2570(*\xb0\u25bd\xb0*)\u256f","\u4e56":" o(*^\uff20^*)o","\u9676\u9189":"( *\ufe3e\u25bd\ufe3e)","\u5582":" (#`O\u2032)","\u6123\u4f4f":" (\xb0\u30fc\xb0\u3003)","\u653e\u5c41":" \u25cb|\uffe3|_ =3","\u53ef\u6076":"\uff08\uff1d\u3002\uff1d\uff09","\u751f\u6c14":" (\u30fc`\u2032\u30fc)","\u6ee1\u8db3":" o(*\uffe3\ufe36\uffe3*)o","\u5d29\u6e83":"o(\u2267\u53e3\u2266)o","\u5443\u5443\u5443":"(\u2299\ufe4f\u2299)","\u6655":"X\ufe4fX","\u5446":" \u2501\u2533\u2501\u3000\u2501\u2533\u2501","\u55b5\u661f\u4eba":" ( =\u2022\u03c9\u2022= )m","\u55b5\u545c":" \u2261\u03c9\u2261","\u718a":"(*\uffe3(\u30a8)\uffe3)","\u5bb3\u7f9e":" (\u273f\u25e1\u203f\u25e1)",good:" o(\uffe3\u25bd\uffe3)\uff44","\u53ef\u7231":"*\uff3e-\uff3e*","\u7206\u7b11":"\u30fe(\u2267\u25bd\u2266*)o","\u5356\u840c":"=\uffe3\u03c9\uffe3="},B="layui-anim-upbit",z={status:function(a,e){function i(){a.next().hide().removeClass(B)}var t=a.attr("lay-type");"show"===t?(layui.stope(e),a.next().show().addClass(B),f(document).off("click",i).on("click",i)):(e=a.parent().prev(),a.addClass(C).siblings().removeClass(C),e.html(a.find("cite").html()),e.removeClass("layim-status-"+("online"===t?"hide":"online")).addClass("layim-status-"+t),layui.event.call(a[0],b,"online",{status:t}))},sign:function(){var a=r.find(".layui-layim-remark");a.on("change",function(){var a=this.value;layui.event.call(this,b,"sign",{value:a})}),a.on("keyup",function(a){13===a.keyCode&&this.blur()})},tab:function(a){var e,i=".layim-tab-content",t=r.find(".layui-layim-tab>li");"number"==typeof a?(e=a,a=t.eq(e)):e=a.index(),(2<e?t:(z.tab.index=e,a.addClass(C).siblings())).removeClass(C),r.find(i).eq(e).addClass(x).siblings(i).removeClass(x)},spread:function(a){var e=a.attr("lay-type"),i="true"===e?"false":"true",t=w.options,l=_();a.next()["true"===e?"removeClass":"addClass"](x),l["spread"+a.parent().index()]=i,layui.data(t.LOCAL_TABLE,{key:w.user.id,value:l}),a.attr("lay-type",i),a.find(".layui-icon").html("true"==i?"&#xe61a;":"&#xe602;")},search:function(a){function e(a){var e=d.val().replace(/\s/);if(""===e)z.tab(0|z.tab.index);else{for(var i=[],t=w.friend||[],l=w.group||[],n="",o=0;o<t.length;o++)for(var s=0;s<(t[o].list||[]).length;s++)-1!==t[o].list[s].username.indexOf(e)&&(t[o].list[s].type="friend",t[o].list[s].index=o,t[o].list[s].list=s,i.push(t[o].list[s]));for(var r=0;r<l.length;r++)-1!==l[r].groupname.indexOf(e)&&(l[r].type="group",l[r].index=r,l[r].list=r,i.push(l[r]));if(0<i.length)for(var c=0;c<i.length;c++)n+='<li layim-event="chat" data-type="'+i[c].type+'" data-index="'+i[c].index+'" data-list="'+i[c].list+'"><img src="'+(i[c].avatar||w.options.defaultAvatar)+'"><span>'+(i[c].username||i[c].groupname||"\u4f5a\u540d")+"</span><p>"+(i[c].remark||i[c].sign||"")+"</p></li>";else n='<li class="layim-null">\u65e0\u641c\u7d22\u7ed3\u679c</li>';u.html(n),z.tab(3)}}var i=r.find(".layui-layim-search"),u=r.find("#layui-layim-search"),d=i.find("input"),t=w.options.contactsPanel;!t.showFriend&&t.showGroup?z.tab.index=1:t.showFriend||t.showGroup||(z.tab.index=2),i.show(),d.focus(),d.off("keyup",e).on("keyup",e)},closeSearch:function(a){a.parent().hide(),z.tab(0|z.tab.index)},msgbox:function(){var a=r.find(".layim-tool-msgbox"),e=w.options,i=e.pageurl||{},e="function"==typeof i.msgbox?i.msgbox({config:e,user:w.user}):i.msgbox;if("string"==typeof e)return h.close(z.msgbox.index),a.find("span").removeClass(ia).html(""),z.msgbox.index=h.open({type:2,title:"\u6d88\u606f\u76d2\u5b50",shade:!1,maxmin:!0,area:["600px","518px"],skin:"layui-layer-border",resize:!1,content:e})},find:function(){var a=w.options,e=a.pageurl||{},a="function"==typeof e.find?e.find({config:a,user:w.user}):e.find;if("string"==typeof a)return h.close(z.find.index),z.find.index=h.open({type:2,title:"\u67e5\u627e",shade:!1,maxmin:!0,area:["1000px","518px"],skin:"layui-layer-border",resize:!1,content:a})},set:function(){var e,n=w.options,a=(e=[],layui.each(Array(5),function(a){e.push(L("images/background/"+(a+1)+".jpg"))}),e);h.open({type:1,title:"\u8bbe\u7f6e",shade:!1,area:"260px",anim:5,skin:"layui-layer-border layui-layim-layer",id:"layui-layim-set",zIndex:h.zIndex+999999,resize:!1,content:g(q).render({backgroundImages:a}),success:function(a,e,i){o.render(a.find(".layui-form"));function t(a){if(a){if(v.ie)return;l.theme="dark",o.val("layim-set",{theme:!0})}else delete l.theme;layui.data(n.LOCAL_TABLE,{key:w.user.id,value:l})}var l=_();t("dark"===l.theme),o.on("switch(layim-theme-mode)",function(a){var e=a.elem.checked;t(a.elem.checked),$(e?"dark":"light")})}})},setBackgroundImage:function(a){var e=a.attr("src"),i=w.options,t=_();(t.backgroundImage=e)||delete t.backgroundImage,layui.data(i.LOCAL_TABLE,{key:w.user.id,value:t});try{r.css({"background-image":e?"url("+e+")":"none"}),y.css({"background-image":e?"url("+e+")":"none"})}catch(a){}i=(e||"").replace(L("images/background"),"");layui.event.call(a[0],b,"backgroundImage",{filename:i,src:e})},chat:function(a){var e=_(),i=a.data("type"),t=a.data("index"),a=a.attr("data-list")||a.index(),l={};"friend"===i?l=w[i][t].list[a]:"group"===i?l=w[i][a]:"history"===i&&(l=(e.history||{})[t]||{}),l.username=l.username||l.groupname,"history"!==i&&(l.type=i),E(l)},tabChat:function(a){P(a)},closeChat:function(a,e){P(a.parent(),1),layui.stope(e)},closeThisChat:function(){P(null,1)},groupMembers:function(s,a){function r(){e.html("&#xe61a;"),s.data("down",null),h.close(z.groupMembers.index)}var e=s.find(".layui-icon"),c=".layim.open.members";s.data("down")?r():(e.html("&#xe619;"),s.data("down",!0),z.groupMembers.index=h.tips('<ul class="layim-members-list layim-border"></ul>',s,{tips:3,time:0,anim:5,isOutAnim:!1,fixed:!0,skin:"layui-layim-members layui-layim-layer",success:function(a){var e=I(),i=a.find(".layim-members-list"),t=[],l={},n=y.find(".layui-layer-max").hasClass("layui-layer-maxmin"),o="none"===y.find(".layim-chat-list").css("display");n&&i.css({width:f(window).width()-22-(o||200)}),n="layui-layim-loading",(o=i).html('<span class="'+n+'"><i class="layui-icon layui-icon-loading-1 layui-anim layui-anim-rotate layui-anim-loop"></i></span>'),o.children("."+n),layui.event.call(s[0],b,"viewMmembers",{ajax:u,layero:a,receiver:e.data,render:function(a){layui.each(a.list,function(a,e){t.push(['<li data-uid="'+e.id+'">','<a href="javascript:;">','<img src="'+(e.avatar||w.options.defaultAvatar)+'">',"<cite>"+e.username+"</cite>","</a>","</li>"].join("")),l[e.id]=e}),i.html(t.join("")),s.find(".layim-chat-members").html(a.members||(a.list||[]).length+"\u4eba"),i.find("li").on("click",function(){var a=f(this).data("uid"),a=l[a];E({username:a.username,type:"friend",avatar:a.avatar||w.options.defaultAvatar,id:a.id}),r()})}}),a.on("mousedown"+c,function(a){layui.stope(a)})}}),f(document).off("mousedown"+c).on("mousedown"+c,r),f(window).off("resize"+c).on("resize"+c,r),s.off("mousedown"+c).on("mousedown"+c,layui.stope))},send:function(){S()},setSend:function(a,e){var i=w.options,t=z.setSend.box=a.siblings(".layim-menu-box"),l=a.attr("lay-type");"show"===l?(layui.stope(e),t.show().addClass(B),f(document).off("click",z.setSendHide).on("click",z.setSendHide)):(t=_(),a.addClass(C).siblings().removeClass(C),t.sendHotKey=l,layui.data(i.LOCAL_TABLE,{key:w.user.id,value:t}),z.setSendHide(e,a.parent()))},setSendHide:function(a,e){(e||z.setSend.box).hide().removeClass(B)},face:function(a,e){var i,t="",l=I();for(i in oa)t+='<li title="'+i+'">'+oa[i]+"</li>";z.face.index=h.tips(t='<ul class="layui-clear layim-face-list">'+t+"</ul>",a,{tips:1,time:0,fixed:!0,anim:5,skin:"layui-layim-face",success:function(a){a.find(".layim-face-list>li").on("mousedown",function(a){layui.stope(a)}).on("click",function(){n(l.textarea[0],this.innerHTML+" "),h.close(z.face.index)})}});a=".layim.chatTools.face";f(document).off("mousedown"+a,z.faceHide).on("mousedown"+a,z.faceHide),f(window).off("resize"+a,z.faceHide).on("resize"+a,z.faceHide),layui.stope(e)},faceHide:function(){h.close(z.face.index)},file:function(a){var t=a.data("chat-toolname"),l=I(),e=w.options[{image:"uploadImage",file:"uploadFile"}[t]]||{};layui.upload.render({url:e.url||"",method:e.toolname,elem:a.find("input")[0],accept:t,done:function(a){var e,i;0==a.code?(e=(i=a.data=a.data||{}).filename||"",i=i.src,"image"===t?n(l.textarea[0],"![]("+i+")"):"file"===t&&n(l.textarea[0],"!file["+(e||"\u4e0b\u8f7d\u6587\u4ef6")+"]("+i+")"),S()):h.msg(a.msg||"\u4e0a\u4f20\u5931\u8d25")}})},remoteMedia:function(a){var i=a.data("chat-toolname"),t=I();h.prompt({title:"\u8bf7\u8f93\u5165\u8fdc\u7a0b"+{audio:"\u97f3\u9891",video:"\u89c6\u9891"}[i]+" URL",shade:!1,anim:5,id:"LAYIM-LAYER-CHAT-TOOL-"+i,offset:[a.offset().top-f(window).scrollTop()-168+"px",a.offset().left+"px"]},function(a,e){n(t.textarea[0],"!"+i+"("+a+")"),S(),h.close(e)})},extendChatTool:function(a){var i,t=a.data("chat-toolname"),e=I(),l=w.options.chatTools,l=(layui.each(l,function(a,e){if(e.name===t)return i=e,!0}),i);l&&"function"==typeof l.onClick&&l.onClick({data:e,elem:a,insert:function(a){n(e.textarea[0],a)}})},playAudio:function(a){function e(){t.pause(),a.removeAttr("status"),a.find("i").addClass("layui-icon-play").removeClass("layui-icon-pause")}var i=a.data("audio"),t=i||document.createElement("audio");return a.data("error")?h.msg("\u64ad\u653e\u97f3\u9891\u6e90\u5f02\u5e38"):t.play?void(a.attr("status")?e():(i||(t.src=a.data("src")),t.play(),a.attr("status","pause"),a.data("audio",t),a.find("i").addClass("layui-icon-pause").removeClass("layui-icon-play"),t.onended=function(){e()},t.onerror=function(){h.msg("\u64ad\u653e\u97f3\u9891\u6e90\u5f02\u5e38"),a.data("error",!0),e()})):h.msg("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 audio")},playVideo:function(a){a=a.data("src");if(!document.createElement("video").play)return h.msg("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301video");h.close(z.playVideo.index),z.playVideo.index=h.open({type:1,title:"\u64ad\u653e\u89c6\u9891",area:["460px","300px"],maxmin:!0,shade:!1,skin:"layui-layim-layer",content:'<div style="background-color: #000; height: 100%;"><video style="position: absolute; width: 100%; height: 100%;" src="'+a+'" loop="loop" autoplay="autoplay"></video></div>'})},chatlog:function(a){var e=w.options,i=e.pageurl||{},t=I();return i.chatlog?"string"==typeof(e="function"==typeof i.chatlog?i.chatlog({config:e,user:w.user,receiver:t.data}):i.chatlog)?(h.close(z.chatlog.index),z.chatlog.index=h.open({type:2,maxmin:!0,title:"\u4e0e <strong>"+t.data.username+"</strong> \u7684\u804a\u5929\u8bb0\u5f55",area:["450px","100%"],shade:!1,offset:"r",anim:"slideLeft",id:"layui-layim-chatlog",content:e})):void 0:h.msg("\u672a\u5f00\u542f\u66f4\u591a\u804a\u5929\u8bb0\u5f55")},menuHistory:function(a,e){var i,t=w.options,l=_(),n=a.parent(),a=a.data("type"),o=r.find(".layim-list-history"),s='<li class="layim-null">\u6682\u65e0\u5386\u53f2\u4f1a\u8bdd</li>';"one"===a?(delete(i=l.history)[n.data("index")],l.history=i,layui.data(t.LOCAL_TABLE,{key:w.user.id,value:l}),f(".layim-list-history li.layim-"+n.data("index")).remove(),0===o.find("li").length&&o.html(s)):"all"===a&&(delete l.history,layui.data(t.LOCAL_TABLE,{key:w.user.id,value:l}),o.html(s)),h.closeAll("tips")}};t.on("layim-event",z),e(b,new a)}).link(layui.cache.layimResPath+"layim.css","skinlayimcss");